(function(){function e(e){var t,r,a,n,i,s=!1,o=4,c=function(){s=!0,a=[0,1,2,4,8,16,32,64,128,27,54];for(var e=Array(256),o=0;128>o;++o)e[o]=o<<1,e[o+128]=283^o+128<<1;t=Array(256),r=Array(256),n=Array(4),i=Array(4);for(var o=0;4>o;++o)n[o]=Array(256),i[o]=Array(256);for(var c,u,l,f,d,p,h,g=0,y=0,o=0;256>o;++o){f=y^y<<1^y<<2^y<<3^y<<4,f=99^(f>>8^255&f),t[g]=f,r[f]=g,d=e[f],c=e[g],u=e[c],l=e[u],p=d<<24^f<<16^f<<8^(f^d),h=(c^u^l)<<24^(g^l)<<16^(g^u^l)<<8^(g^c^l);for(var m=0;4>m;++m)n[m][g]=p,i[m][f]=h,p=p<<24|p>>>8,h=h<<24|h>>>8;0===g?g=y=1:(g=c^e[e[e[c^l]]],y^=e[e[y]])}},u=function(e,r){for(var n,s=e.slice(0),c=1,u=s.length,l=u+6+1,f=o*l,d=u;f>d;++d)n=s[d-1],0===d%u?(n=t[255&n>>>16]<<24^t[255&n>>>8]<<16^t[255&n]<<8^t[n>>>24]^a[c]<<24,c++):u>6&&4==d%u&&(n=t[n>>>24]<<24^t[255&n>>>16]<<16^t[255&n>>>8]<<8^t[255&n]),s[d]=s[d-u]^n;if(r){for(var p,h=i[0],g=i[1],y=i[2],m=i[3],v=s.slice(0),f=s.length,d=0,C=f-o;f>d;d+=o,C-=o)if(0===d||d===f-o)v[d]=s[C],v[d+1]=s[C+3],v[d+2]=s[C+2],v[d+3]=s[C+1];else for(var E=0;o>E;++E)p=s[C+E],v[d+(3&-E)]=h[t[p>>>24]]^g[t[255&p>>>16]]^y[t[255&p>>>8]]^m[t[255&p]];s=v}return s},l=function(e,a,s,o){var c,u,l,f,d,p=e.length/4-1;o?(c=i[0],u=i[1],l=i[2],f=i[3],d=r):(c=n[0],u=n[1],l=n[2],f=n[3],d=t);var h,g,y,m,v,C,E;h=a[0]^e[0],g=a[o?3:1]^e[1],y=a[2]^e[2],m=a[o?1:3]^e[3];for(var S=3,T=1;p>T;++T)v=c[h>>>24]^u[255&g>>>16]^l[255&y>>>8]^f[255&m]^e[++S],C=c[g>>>24]^u[255&y>>>16]^l[255&m>>>8]^f[255&h]^e[++S],E=c[y>>>24]^u[255&m>>>16]^l[255&h>>>8]^f[255&g]^e[++S],m=c[m>>>24]^u[255&h>>>16]^l[255&g>>>8]^f[255&y]^e[++S],h=v,g=C,y=E;s[0]=d[h>>>24]<<24^d[255&g>>>16]<<16^d[255&y>>>8]<<8^d[255&m]^e[++S],s[o?3:1]=d[g>>>24]<<24^d[255&y>>>16]<<16^d[255&m>>>8]<<8^d[255&h]^e[++S],s[2]=d[y>>>24]<<24^d[255&m>>>16]<<16^d[255&h>>>8]<<8^d[255&g]^e[++S],s[o?1:3]=d[m>>>24]<<24^d[255&h>>>16]<<16^d[255&g>>>8]<<8^d[255&y]^e[++S]},f=function(t,r,a,n){var i=null;if(s||c(),t.constructor!=String||16!=t.length&&24!=t.length&&32!=t.length){if(t.constructor==Array&&(16==t.length||24==t.length||32==t.length))for(var f=t,t=e.util.createBuffer(),d=0;f.length>d;++d)t.putByte(f[d])}else t=e.util.createBuffer(t);if(t.constructor!=Array){var f=t;t=[];var p=f.length();if(16==p||24==p||32==p){p>>>=2;for(var d=0;p>d;++d)t.push(f.getInt32())}}if(t.constructor==Array&&(4==t.length||6==t.length||8==t.length)){var h,g,y,m,v,C,E=u(t,n),S=o<<2;i={output:null},i.update=function(e){C||h.putBuffer(e);for(var t=n&&!C?S<<1:S;h.length()>=t;){if(n)for(var r=0;o>r;++r)y[r]=h.getInt32();else for(var r=0;o>r;++r)y[r]=v[r]^h.getInt32();if(l(E,y,m,n),n){for(var r=0;o>r;++r)g.putInt32(v[r]^m[r]);v=y.slice(0)}else{for(var r=0;o>r;++r)g.putInt32(m[r]);v=m}}},i.finish=function(e){var t=!0;if(!n)if(e)t=e(S,h,n);else{var r=h.length()==S?S:S-h.length();h.fillWithByte(r,r)}if(t&&(C=!0,i.update()),n&&(t=0===h.length()))if(e)t=e(S,g,n);else{var a=g.length(),s=g.at(a-1);s>o<<2?t=!1:g.truncate(s)}return t},i.start=function(t,r){if(t=t||v.slice(0),t.constructor==String&&16==t.length)t=e.util.createBuffer(t);else if(t.constructor==Array&&16==t.length)for(var a=t,t=e.util.createBuffer(),n=0;16>n;++n)t.putByte(a[n]);if(t.constructor!=Array){var a=t;t=Array(4),t[0]=a.getInt32(),t[1]=a.getInt32(),t[2]=a.getInt32(),t[3]=a.getInt32()}h=e.util.createBuffer(),g=r||e.util.createBuffer(),v=t.slice(0),y=Array(o),m=Array(o),C=!1,i.output=g},null!==r&&i.start(r,a)}return i};e.aes=e.aes||{},e.aes.startEncrypting=function(e,t,r){return f(e,t,r,!1)},e.aes.createEncryptionCipher=function(e){return f(e,null,null,!1)},e.aes.startDecrypting=function(e,t,r){return f(e,t,r,!0)},e.aes.createDecryptionCipher=function(e){return f(e,null,null,!0)},e.aes._expandKey=function(e,t){return s||c(),u(e,t)},e.aes._updateBlock=l}var t="aes",r=["./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})})(),function(){function e(e){var t=e.sha1=e.sha1||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.sha1=e.md.algorithms.sha1=t;var r=null,a=!1,n=function(){r=String.fromCharCode(128),r+=e.util.fillString(String.fromCharCode(0),64),a=!0},i=function(e,t,r){for(var a,n,i,s,o,c,u,l,f=r.length();f>=64;){for(n=e.h0,i=e.h1,s=e.h2,o=e.h3,c=e.h4,l=0;16>l;++l)a=r.getInt32(),t[l]=a,u=o^i&(s^o),a=(n<<5|n>>>27)+u+c+1518500249+a,c=o,o=s,s=i<<30|i>>>2,i=n,n=a;for(;20>l;++l)a=t[l-3]^t[l-8]^t[l-14]^t[l-16],a=a<<1|a>>>31,t[l]=a,u=o^i&(s^o),a=(n<<5|n>>>27)+u+c+1518500249+a,c=o,o=s,s=i<<30|i>>>2,i=n,n=a;for(;32>l;++l)a=t[l-3]^t[l-8]^t[l-14]^t[l-16],a=a<<1|a>>>31,t[l]=a,u=i^s^o,a=(n<<5|n>>>27)+u+c+1859775393+a,c=o,o=s,s=i<<30|i>>>2,i=n,n=a;for(;40>l;++l)a=t[l-6]^t[l-16]^t[l-28]^t[l-32],a=a<<2|a>>>30,t[l]=a,u=i^s^o,a=(n<<5|n>>>27)+u+c+1859775393+a,c=o,o=s,s=i<<30|i>>>2,i=n,n=a;for(;60>l;++l)a=t[l-6]^t[l-16]^t[l-28]^t[l-32],a=a<<2|a>>>30,t[l]=a,u=i&s|o&(i^s),a=(n<<5|n>>>27)+u+c+2400959708+a,c=o,o=s,s=i<<30|i>>>2,i=n,n=a;for(;80>l;++l)a=t[l-6]^t[l-16]^t[l-28]^t[l-32],a=a<<2|a>>>30,t[l]=a,u=i^s^o,a=(n<<5|n>>>27)+u+c+3395469782+a,c=o,o=s,s=i<<30|i>>>2,i=n,n=a;e.h0+=n,e.h1+=i,e.h2+=s,e.h3+=o,e.h4+=c,f-=64}};t.create=function(){a||n();var t=null,s=e.util.createBuffer(),o=Array(80),c={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0};return c.start=function(){c.messageLength=0,s=e.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520}},c.start(),c.update=function(r,a){"utf8"===a&&(r=e.util.encodeUtf8(r)),c.messageLength+=r.length,s.putBytes(r),i(t,o,s),(s.read>2048||0===s.length())&&s.compact()},c.digest=function(){var a=c.messageLength,n=e.util.createBuffer();n.putBytes(s.bytes()),n.putBytes(r.substr(0,64-(a+8)%64)),n.putInt32(255&a>>>29),n.putInt32(4294967295&a<<3);var u={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4};i(u,o,n);var l=e.util.createBuffer();return l.putInt32(u.h0),l.putInt32(u.h1),l.putInt32(u.h2),l.putInt32(u.h3),l.putInt32(u.h4),l},c}}var t="sha1",r=["./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=e.sha256=e.sha256||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.sha256=e.md.algorithms.sha256=t;var r=null,a=!1,n=null,i=function(){r=String.fromCharCode(128),r+=e.util.fillString(String.fromCharCode(0),64),n=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=!0},s=function(e,t,r){for(var a,i,s,o,c,u,l,f,d,p,h,g,y,m,v,C=r.length();C>=64;){for(l=0;16>l;++l)t[l]=r.getInt32();for(;64>l;++l)a=t[l-2],a=(a>>>17|a<<15)^(a>>>19|a<<13)^a>>>10,i=t[l-15],i=(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,t[l]=4294967295&a+t[l-7]+i+t[l-16];for(f=e.h0,d=e.h1,p=e.h2,h=e.h3,g=e.h4,y=e.h5,m=e.h6,v=e.h7,l=0;64>l;++l)o=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),c=m^g&(y^m),s=(f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),u=f&d|p&(f^d),a=v+o+c+n[l]+t[l],i=s+u,v=m,m=y,y=g,g=4294967295&h+a,h=p,p=d,d=f,f=4294967295&a+i;e.h0=4294967295&e.h0+f,e.h1=4294967295&e.h1+d,e.h2=4294967295&e.h2+p,e.h3=4294967295&e.h3+h,e.h4=4294967295&e.h4+g,e.h5=4294967295&e.h5+y,e.h6=4294967295&e.h6+m,e.h7=4294967295&e.h7+v,C-=64}};t.create=function(){a||i();var t=null,n=e.util.createBuffer(),o=Array(64),c={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0};return c.start=function(){c.messageLength=0,n=e.util.createBuffer(),t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225}},c.start(),c.update=function(r,a){"utf8"===a&&(r=e.util.encodeUtf8(r)),c.messageLength+=r.length,n.putBytes(r),s(t,o,n),(n.read>2048||0===n.length())&&n.compact()},c.digest=function(){var a=c.messageLength,i=e.util.createBuffer();i.putBytes(n.bytes()),i.putBytes(r.substr(0,64-(a+8)%64)),i.putInt32(255&a>>>29),i.putInt32(4294967295&a<<3);var u={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4,h5:t.h5,h6:t.h6,h7:t.h7};s(u,o,i);var l=e.util.createBuffer();return l.putInt32(u.h0),l.putInt32(u.h1),l.putInt32(u.h2),l.putInt32(u.h3),l.putInt32(u.h4),l.putInt32(u.h5),l.putInt32(u.h6),l.putInt32(u.h7),l},c}}var t="sha256",r=["./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=e.md5=e.md5||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.md5=e.md.algorithms.md5=t;var r=null,a=null,n=null,i=null,s=!1,o=function(){r=String.fromCharCode(128),r+=e.util.fillString(String.fromCharCode(0),64),a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],n=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],i=Array(64);for(var t=0;64>t;++t)i[t]=Math.floor(4294967296*Math.abs(Math.sin(t+1)));s=!0},c=function(e,t,r){for(var s,o,c,u,l,f,d,p,h=r.length();h>=64;){for(o=e.h0,c=e.h1,u=e.h2,l=e.h3,p=0;16>p;++p)t[p]=r.getInt32Le(),f=l^c&(u^l),s=o+f+i[p]+t[p],d=n[p],o=l,l=u,u=c,c+=s<<d|s>>>32-d;for(;32>p;++p)f=u^l&(c^u),s=o+f+i[p]+t[a[p]],d=n[p],o=l,l=u,u=c,c+=s<<d|s>>>32-d;for(;48>p;++p)f=c^u^l,s=o+f+i[p]+t[a[p]],d=n[p],o=l,l=u,u=c,c+=s<<d|s>>>32-d;for(;64>p;++p)f=u^(c|~l),s=o+f+i[p]+t[a[p]],d=n[p],o=l,l=u,u=c,c+=s<<d|s>>>32-d;e.h0=4294967295&e.h0+o,e.h1=4294967295&e.h1+c,e.h2=4294967295&e.h2+u,e.h3=4294967295&e.h3+l,h-=64}};t.create=function(){s||o();var t=null,a=e.util.createBuffer(),n=Array(16),i={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0};return i.start=function(){i.messageLength=0,a=e.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878}},i.start(),i.update=function(r,s){"utf8"===s&&(r=e.util.encodeUtf8(r)),i.messageLength+=r.length,a.putBytes(r),c(t,n,a),(a.read>2048||0===a.length())&&a.compact()},i.digest=function(){var s=i.messageLength,o=e.util.createBuffer();o.putBytes(a.bytes()),o.putBytes(r.substr(0,64-(s+8)%64)),o.putInt32Le(4294967295&s<<3),o.putInt32Le(255&s>>>29);var u={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3};c(u,n,o);var l=e.util.createBuffer();return l.putInt32Le(u.h0),l.putInt32Le(u.h1),l.putInt32Le(u.h2),l.putInt32Le(u.h3),l},i}}var t="md5",r=["./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){e.md=e.md||{},e.md.algorithms={md5:e.md5,sha1:e.sha1,sha256:e.sha256},e.md.md5=e.md5,e.md.sha1=e.sha1,e.md.sha256=e.sha256}var t="md",r=["./md5","./sha1","./sha256"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=e.asn1=e.asn1||{};t.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},t.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},t.create=function(e,t,r,a){if(a.constructor==Array){for(var n=[],i=0;a.length>i;++i)void 0!==a[i]&&n.push(a[i]);a=n}return{tagClass:e,type:t,constructed:r,composed:r||a.constructor==Array,value:a}};var r=function(e){var t=e.getByte();if(128==t)return void 0;var r,a=128&t;return r=a?e.getInt((127&t)<<3):t};t.fromDer=function(a,n){if(void 0===n&&(n=!0),a.constructor==String&&(a=e.util.createBuffer(a)),2>a.length())throw{message:"Too few bytes to parse DER.",bytes:a.length()};var i=a.getByte(),s=192&i,o=31&i,c=r(a);if(c>a.length()){if(n)throw{message:"Too few bytes to read ASN.1 value.",detail:a.length()+" < "+c};c=a.length()}var u,l=32==(32&i),f=l;if(!f&&s===t.Class.UNIVERSAL&&o===t.Type.BITSTRING&&c>1){var d=a.read,p=a.getByte();if(0===p){i=a.getByte();var h=192&i;if(h===t.Class.UNIVERSAL||h===t.Class.CONTEXT_SPECIFIC)try{var g=r(a);f=g===c-(a.read-d),f&&(++d,--c)}catch(y){}}a.read=d}if(f)if(u=[],void 0===c)for(;;){if(a.bytes(2)===String.fromCharCode(0,0)){a.getBytes(2);break}u.push(t.fromDer(a,n))}else for(var m=a.length();c>0;)u.push(t.fromDer(a,n)),c-=m-a.length(),m=a.length();else{if(void 0===c)throw{message:"Non-constructed ASN.1 object of indefinite length."};if(o===t.Type.BMPSTRING){u="";for(var v=0;c>v;v+=2)u+=String.fromCharCode(a.getInt16())}else u=a.getBytes(c)}return t.create(s,o,l,u)},t.toDer=function(r){var a=e.util.createBuffer(),n=r.tagClass|r.type,i=e.util.createBuffer();if(r.composed){r.constructed?n|=32:i.putByte(0);for(var s=0;r.value.length>s;++s)void 0!==r.value[s]&&i.putBuffer(t.toDer(r.value[s]))}else if(r.type===t.Type.BMPSTRING)for(var s=0;r.value.length>s;++s)i.putInt16(r.value.charCodeAt(s));else i.putBytes(r.value);if(a.putByte(n),127>=i.length())a.putByte(127&i.length());else{var o=i.length(),c="";do c+=String.fromCharCode(255&o),o>>>=8;while(o>0);a.putByte(128|c.length);for(var s=c.length-1;s>=0;--s)a.putByte(c.charCodeAt(s))}return a.putBuffer(i),a},t.oidToDer=function(t){var r=t.split("."),a=e.util.createBuffer();a.putByte(40*parseInt(r[0],10)+parseInt(r[1],10));for(var n,i,s,o,c=2;r.length>c;++c){n=!0,i=[],s=parseInt(r[c],10);do o=127&s,s>>>=7,n||(o|=128),i.push(o),n=!1;while(s>0);for(var u=i.length-1;u>=0;--u)a.putByte(i[u])}return a},t.derToOid=function(t){var r;t.constructor==String&&(t=e.util.createBuffer(t));var a=t.getByte();r=Math.floor(a/40)+"."+a%40;for(var n=0;t.length()>0;)a=t.getByte(),n<<=7,128&a?n+=127&a:(r+="."+(n+a),n=0);return r},t.utcTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,2),10);r=r>=50?1900+r:2e3+r;var a=parseInt(e.substr(2,2),10)-1,n=parseInt(e.substr(4,2),10),i=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),o=0;if(e.length>11){var c=e.charAt(10),u=10;"+"!==c&&"-"!==c&&(o=parseInt(e.substr(10,2),10),u+=2)}if(t.setUTCFullYear(r,a,n),t.setUTCHours(i,s,o,0),u&&(c=e.charAt(u),"+"===c||"-"===c)){var l=parseInt(e.substr(u+1,2),10),f=parseInt(e.substr(u+4,2),10),d=60*l+f;d*=6e4,"+"===c?t.setTime(+t-d):t.setTime(+t+d)}return t},t.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),a=parseInt(e.substr(4,2),10)-1,n=parseInt(e.substr(6,2),10),i=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),o=parseInt(e.substr(12,2),10),c=0,u=0,l=!1;"Z"==e.charAt(e.length-1)&&(l=!0);var f=e.length-5,d=e.charAt(f);if("+"===d||"-"===d){var p=parseInt(e.substr(f+1,2),10),h=parseInt(e.substr(f+4,2),10);u=60*p+h,u*=6e4,"+"===d&&(u*=-1),l=!0}return"."==e.charAt(14)&&(c=1e3*parseFloat(e.substr(14),10)),l?(t.setUTCFullYear(r,a,n),t.setUTCHours(i,s,o,c),t.setTime(+t+u)):(t.setFullYear(r,a,n),t.setHours(i,s,o,c)),t},t.dateToUtcTime=function(e){var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var a=0;r.length>a;++a)2>r[a].length&&(t+="0"),t+=r[a];return t+="Z"},t.validate=function(e,r,a,n){var i=!1;if(e.tagClass!==r.tagClass&&void 0!==r.tagClass||e.type!==r.type&&void 0!==r.type)n&&(e.tagClass!==r.tagClass&&n.push("["+r.name+"] "+'Expected tag class "'+r.tagClass+'", got "'+e.tagClass+'"'),e.type!==r.type&&n.push("["+r.name+"] "+'Expected type "'+r.type+'", got "'+e.type+'"'));else if(e.constructed===r.constructed||r.constructed===void 0){if(i=!0,r.value&&r.value.constructor==Array)for(var s=0,o=0;i&&r.value.length>o;++o)i=r.value[o].optional||!1,e.value[s]&&(i=t.validate(e.value[s],r.value[o],a,n),i?++s:r.value[o].optional&&(i=!0)),!i&&n&&n.push("["+r.name+"] "+'Tag class "'+r.tagClass+'", type "'+r.type+'" expected value length "'+r.value.length+'", got "'+e.value.length+'"');i&&a&&(r.capture&&(a[r.capture]=e.value),r.captureAsn1&&(a[r.captureAsn1]=e))}else n&&n.push("["+r.name+"] "+'Expected constructed "'+r.constructed+'", got "'+e.constructed+'"');return i};var a=/[^\\u0000-\\u00ff]/;t.prettyPrint=function(r,n,i){var s="";n=n||0,i=i||2,n>0&&(s+="\n");for(var o="",c=0;n*i>c;++c)o+=" ";switch(s+=o+"Tag: ",r.tagClass){case t.Class.UNIVERSAL:s+="Universal:";break;case t.Class.APPLICATION:s+="Application:";break;case t.Class.CONTEXT_SPECIFIC:s+="Context-Specific:";break;case t.Class.PRIVATE:s+="Private:"}if(r.tagClass===t.Class.UNIVERSAL)switch(s+=r.type,r.type){case t.Type.NONE:s+=" (None)";break;case t.Type.BOOLEAN:s+=" (Boolean)";break;case t.Type.BITSTRING:s+=" (Bit string)";break;case t.Type.INTEGER:s+=" (Integer)";break;case t.Type.OCTETSTRING:s+=" (Octet string)";break;case t.Type.NULL:s+=" (Null)";break;case t.Type.OID:s+=" (Object Identifier)";break;case t.Type.ODESC:s+=" (Object Descriptor)";break;case t.Type.EXTERNAL:s+=" (External or Instance of)";break;case t.Type.REAL:s+=" (Real)";break;case t.Type.ENUMERATED:s+=" (Enumerated)";break;case t.Type.EMBEDDED:s+=" (Embedded PDV)";break;case t.Type.UTF8:s+=" (UTF8)";break;case t.Type.ROID:s+=" (Relative Object Identifier)";break;case t.Type.SEQUENCE:s+=" (Sequence)";break;case t.Type.SET:s+=" (Set)";break;case t.Type.PRINTABLESTRING:s+=" (Printable String)";break;case t.Type.IA5String:s+=" (IA5String (ASCII))";break;case t.Type.UTCTIME:s+=" (UTC time)";break;case t.Type.GENERALIZEDTIME:s+=" (Generalized time)";break;case t.Type.BMPSTRING:s+=" (BMP String)"}else s+=r.type;if(s+="\n",s+=o+"Constructed: "+r.constructed+"\n",r.composed){for(var u=0,l="",c=0;r.value.length>c;++c)void 0!==r.value[c]&&(u+=1,l+=t.prettyPrint(r.value[c],n+1,i),r.value.length>c+1&&(l+=","));s+=o+"Sub values: "+u+l}else if(s+=o+"Value: ",r.type===t.Type.OID){var f=t.derToOid(r.value);s+=f,e.pki&&e.pki.oids&&f in e.pki.oids&&(s+=" ("+e.pki.oids[f]+")")}else s+=a.test(r.value)?"0x"+e.util.createBuffer(r.value,"utf8").toHex():0===r.value.length?"[null]":r.value;return s}}var t="asn1",r=["./util","./oids"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){e.debug=e.debug||{},e.debug.storage={},e.debug.get=function(t,r){var a;return t===void 0?a=e.debug.storage:t in e.debug.storage&&(a=r===void 0?e.debug.storage[t]:e.debug.storage[t][r]),a},e.debug.set=function(t,r,a){t in e.debug.storage||(e.debug.storage[t]={}),e.debug.storage[t][r]=a},e.debug.clear=function(t,r){t===void 0?e.debug.storage={}:t in e.debug.storage&&(r===void 0?delete e.debug.storage[t]:delete e.debug.storage[t][r])}}var t="debug",r=[],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){function t(e){for(var t,r=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],a=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],c=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],u=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],l=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],f=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],d=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],h=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],g=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],y=e.length()>8?3:1,m=[],v=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],C=0,E=0;y>E;E++){var S=e.getInt32(),T=e.getInt32();t=252645135&(S>>>4^T),T^=t,S^=t<<4,t=65535&(T>>>-16^S),S^=t,T^=t<<-16,t=858993459&(S>>>2^T),T^=t,S^=t<<2,t=65535&(T>>>-16^S),S^=t,T^=t<<-16,t=1431655765&(S>>>1^T),T^=t,S^=t<<1,t=16711935&(T>>>8^S),S^=t,T^=t<<8,t=1431655765&(S>>>1^T),T^=t,S^=t<<1,t=S<<8|240&T>>>20,S=T<<24|16711680&T<<8|65280&T>>>8|240&T>>>24,T=t;for(var I=0;v.length>I;I++){v[I]?(S=S<<2|S>>>26,T=T<<2|T>>>26):(S=S<<1|S>>>27,T=T<<1|T>>>27),S&=-15,T&=-15;var B=r[S>>>28]|a[15&S>>>24]|n[15&S>>>20]|i[15&S>>>16]|s[15&S>>>12]|o[15&S>>>8]|c[15&S>>>4],A=u[T>>>28]|l[15&T>>>24]|f[15&T>>>20]|d[15&T>>>16]|p[15&T>>>12]|h[15&T>>>8]|g[15&T>>>4];t=65535&(A>>>16^B),m[C++]=B^t,m[C++]=A^t<<16}}return m}var r=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],a=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],n=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],i=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],s=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],o=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],c=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],u=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696],l=function(l,f){l.constructor!=String||8!=l.length&&24!=l.length||(l=e.util.createBuffer(l));var d,p=t(l),h=1,g=0,y=0,m=0,v=0,C=!1,E=null,S=null,T=32==p.length?3:9;d=3==T?f?[0,32,2]:[30,-2,-2]:f?[0,32,2,62,30,-2,64,96,2]:[94,62,-2,32,64,2,30,-2,-2];var I=null;return I={start:function(t,r){t?(l.constructor==String&&8==t.length&&(t=e.util.createBuffer(t)),h=1,g=t.getInt32(),m=t.getInt32()):h=0,C=!1,E=e.util.createBuffer(),S=r||e.util.createBuffer(),I.output=S},update:function(e){for(C||E.putBuffer(e);E.length()>=8;){var t,l=E.getInt32(),I=E.getInt32();1==h&&(f?(l^=g,I^=m):(y=g,v=m,g=l,m=I)),t=252645135&(l>>>4^I),I^=t,l^=t<<4,t=65535&(l>>>16^I),I^=t,l^=t<<16,t=858993459&(I>>>2^l),l^=t,I^=t<<2,t=16711935&(I>>>8^l),l^=t,I^=t<<8,t=1431655765&(l>>>1^I),I^=t,l^=t<<1,l=l<<1|l>>>31,I=I<<1|I>>>31;for(var B=0;T>B;B+=3){for(var A=d[B+1],b=d[B+2],N=d[B];N!=A;N+=b){var R=I^p[N],k=(I>>>4|I<<28)^p[N+1];t=l,l=I,I=t^(a[63&R>>>24]|i[63&R>>>16]|o[63&R>>>8]|u[63&R]|r[63&k>>>24]|n[63&k>>>16]|s[63&k>>>8]|c[63&k])}t=l,l=I,I=t}l=l>>>1|l<<31,I=I>>>1|I<<31,t=1431655765&(l>>>1^I),I^=t,l^=t<<1,t=16711935&(I>>>8^l),l^=t,I^=t<<8,t=858993459&(I>>>2^l),l^=t,I^=t<<2,t=65535&(l>>>16^I),I^=t,l^=t<<16,t=252645135&(l>>>4^I),I^=t,l^=t<<4,1==h&&(f?(g=l,m=I):(l^=y,I^=v)),S.putInt32(l),S.putInt32(I)}},finish:function(e){var t=!0;if(f)if(e)t=e(8,E,!f);else{var r=8==E.length()?8:8-E.length();E.fillWithByte(r,r)}if(t&&(C=!0,I.update()),!f&&(t=0===E.length()))if(e)t=e(8,S,!f);else{var a=S.length(),n=S.at(a-1);n>a?t=!1:S.truncate(n)}return t}}};e.des=e.des||{},e.des.startEncrypting=function(e,t,r){var a=l(e,!0);return a.start(t,r),a},e.des.createEncryptionCipher=function(e){return l(e,!0)},e.des.startDecrypting=function(e,t,r){var a=l(e,!1);return a.start(t,r),a},e.des.createDecryptionCipher=function(e){return l(e,!1)}}var t="des",r=["./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=e.hmac=e.hmac||{};t.create=function(){var t=null,r=null,a=null,n=null,i={};return i.start=function(i,s){if(null!==i)if(i.constructor==String){if(i=i.toLowerCase(),!(i in e.md.algorithms))throw'Unknown hash algorithm "'+i+'"';r=e.md.algorithms[i].create()}else r=i;if(null===s)s=t;else{if(s.constructor==String)s=e.util.createBuffer(s);else if(s.constructor==Array){var o=s;s=e.util.createBuffer();for(var c=0;o.length>c;++c)s.putByte(o[c])}var u=s.length();u>r.blockLength&&(r.start(),r.update(s.bytes()),s=r.digest()),a=e.util.createBuffer(),n=e.util.createBuffer(),u=s.length();for(var c=0;u>c;++c){var o=s.at(c);a.putByte(54^o),n.putByte(92^o)}if(r.blockLength>u)for(var o=r.blockLength-u,c=0;o>c;++c)a.putByte(54),n.putByte(92);t=s,a=a.bytes(),n=n.bytes()}r.start(),r.update(a)},i.update=function(e){r.update(e)},i.getMac=function(){var e=r.digest().bytes();return r.start(),r.update(n),r.update(e),r.digest()},i.digest=i.getMac,i}}var t="hmac",r=["./md","./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=e.pkcs5=e.pkcs5||{};t.pbkdf2=function(t,r,a,n,i){(i===void 0||null===i)&&(i=e.md.sha1.create());var s=i.digestLength;if(n>4294967295*s)throw{message:"Derived key is too long."};var o=Math.ceil(n/s),c=n-(o-1)*s,u=e.hmac.create();u.start(i,t);for(var l,f,d,p="",h=1;o>=h;++h){u.update(r),u.update(e.util.int32ToBytes(h)),l=d=u.digest().getBytes();for(var g=2;a>=g;++g)u.start(null,null),u.update(d),f=u.digest().getBytes(),l=e.util.xorBytes(l,f,s),d=f;p+=o>h?l:l.substr(0,c)}return p}}var t="pbkdf2",r=["./hmac","./md","./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)
}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=e.asn1,r=e.pkcs7=e.pkcs7||{};r.messageFromPem=function(a){var n=e.pki.pemToDer(a),i=t.fromDer(n);return r.messageFromAsn1(i)},r.messageToPem=function(r,a){var n=t.toDer(r.toAsn1());return n=e.util.encode64(n.getBytes(),a||64),"-----BEGIN PKCS7-----\r\n"+n+"\r\n-----END PKCS7-----"},r.messageFromAsn1=function(a){var n={},i=[];if(!t.validate(a,r.asn1.contentInfoValidator,n,i))throw{message:"Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.",errors:i};var s,o=t.derToOid(n.contentType);switch(o){case e.pki.oids.envelopedData:s=r.createEnvelopedData();break;case e.pki.oids.encryptedData:s=r.createEncryptedData();break;case e.pki.oids.signedData:s=r.createSignedData();break;default:throw{message:"Cannot read PKCS#7 message. ContentType with OID "+o+" is not (yet) supported."}}return s.fromAsn1(n.content.value[0]),s};var a=function(a){var n={},i=[];if(!t.validate(a,r.asn1.recipientInfoValidator,n,i))throw{message:"Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.",errors:i};return{version:n.version.charCodeAt(0),issuer:e.pki.RDNAttributesAsArray(n.issuer),serialNumber:e.util.createBuffer(n.serial).toHex(),encContent:{algorithm:t.derToOid(n.encAlgorithm),parameter:n.encParameter.value,content:n.encKey}}},n=function(r){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,String.fromCharCode(r.version)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[e.pki.distinguishedNameToAsn1({attributes:r.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,e.util.hexToBytes(r.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.encContent.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,r.encContent.content)])},i=function(e){for(var t=[],r=0;e.length>r;r++)t.push(a(e[r]));return t},s=function(e){for(var t=[],r=0;e.length>r;r++)t.push(n(e[r]));return t},o=function(r){return[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.pki.oids.data).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,r.parameter.getBytes())]),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,r.content.getBytes())])]},c=function(r,a,n){var i={},s=[];if(!t.validate(a,n,i,s))throw{message:"Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.",errors:s};var o=t.derToOid(i.contentType);if(o!==e.pki.oids.data)throw{message:"Unsupported PKCS#7 message. Only contentType Data supported within EnvelopedData."};if(i.encContent){var c="";if(i.encContent.constructor===Array)for(var u=0;i.encContent.length>u;++u){if(i.encContent[u].type!==t.Type.OCTETSTRING)throw{message:"Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects."};c+=i.encContent[u].value}else c=i.encContent;r.encContent={algorithm:t.derToOid(i.encAlgorithm),parameter:e.util.createBuffer(i.encParameter.value),content:e.util.createBuffer(c)}}if(i.content){var c="";if(i.content.constructor===Array)for(var u=0;i.content.length>u;++u){if(i.content[u].type!==t.Type.OCTETSTRING)throw{message:"Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects."};c+=i.content[u].value}else c=i.content;r.content=e.util.createBuffer(c)}return r.version=i.version.charCodeAt(0),r.rawCapture=i,i},u=function(t){if(void 0===t.encContent.key)throw{message:"Symmetric key not available."};if(void 0===t.content){var r;switch(t.encContent.algorithm){case e.pki.oids["aes128-CBC"]:case e.pki.oids["aes192-CBC"]:case e.pki.oids["aes256-CBC"]:r=e.aes.createDecryptionCipher(t.encContent.key);break;case e.pki.oids["des-EDE3-CBC"]:r=e.des.createDecryptionCipher(t.encContent.key);break;default:throw{message:"Unsupported symmetric cipher, OID "+t.encContent.algorithm}}if(r.start(t.encContent.parameter),r.update(t.encContent.content),!r.finish())throw{message:"Symmetric decryption failed."};t.content=r.output}};r.createSignedData=function(){var t=null;return t={type:e.pki.oids.signedData,version:1,fromAsn1:function(e){c(t,e,r.asn1.signedDataValidator)}}},r.createEncryptedData=function(){var t=null;return t={type:e.pki.oids.encryptedData,version:0,encContent:{algorithm:e.pki.oids["aes256-CBC"]},fromAsn1:function(e){c(t,e,r.asn1.encryptedDataValidator)},decrypt:function(e){void 0!==e&&(t.encContent.key=e),u(t)}}},r.createEnvelopedData=function(){var a=null;return a={type:e.pki.oids.envelopedData,version:0,recipients:[],encContent:{algorithm:e.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=c(a,e,r.asn1.envelopedDataValidator);a.recipients=i(t.recipientInfos.value)},toAsn1:function(){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(a.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,String.fromCharCode(a.version)),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,s(a.recipients)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,o(a.encContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,r=0;a.recipients.length>r;++r){var n=a.recipients[r],i=n.issuer;if(n.serialNumber===e.serialNumber&&i.length===t.length){for(var s=!0,o=0;t.length>o;++o)if(i[o].type!==t[o].type||i[o].value!==t[o].value){s=!1;break}if(s)return n}}},decrypt:function(t,r){if(void 0===a.encContent.key&&void 0!==t&&void 0!==r)switch(t.encContent.algorithm){case e.pki.oids.rsaEncryption:var n=r.decrypt(t.encContent.content);a.encContent.key=e.util.createBuffer(n);break;default:throw{message:"Unsupported asymmetric cipher, OID "+t.encContent.algorithm}}u(a)},addRecipient:function(t){a.recipients.push({version:0,issuer:t.subject.attributes,serialNumber:t.serialNumber,encContent:{algorithm:e.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,r){if(void 0===a.encContent.content){r=r||a.encContent.algorithm,t=t||a.encContent.key;var n,i,s;switch(r){case e.pki.oids["aes128-CBC"]:n=16,i=16,s=e.aes.createEncryptionCipher;break;case e.pki.oids["aes192-CBC"]:n=24,i=16,s=e.aes.createEncryptionCipher;break;case e.pki.oids["aes256-CBC"]:n=32,i=16,s=e.aes.createEncryptionCipher;break;case e.pki.oids["des-EDE3-CBC"]:n=24,i=8,s=e.des.createEncryptionCipher;break;default:throw{message:"Unsupported symmetric cipher, OID "+r}}if(void 0===t)t=e.util.createBuffer(e.random.getBytes(n));else if(t.length()!=n)throw{message:"Symmetric key has wrong length, got "+t.length()+" bytes, expected "+n};a.encContent.algorithm=r,a.encContent.key=t,a.encContent.parameter=e.util.createBuffer(e.random.getBytes(i));var o=s(t);if(o.start(a.encContent.parameter.copy()),o.update(a.content),!o.finish())throw{message:"Symmetric encryption failed."};a.encContent.content=o.output}for(var c=0;a.recipients.length>c;c++){var u=a.recipients[c];if(void 0===u.encContent.content)switch(u.encContent.algorithm){case e.pki.oids.rsaEncryption:u.encContent.content=u.encContent.key.encrypt(a.encContent.key.data);break;default:throw{message:"Unsupported asymmetric cipher, OID "+u.encContent.algorithm}}}}}}}var t="pkcs7",r=["./aes","./asn1","./des","./pkcs7asn1","./pki","./random","./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){function t(e,t,r,a){for(var n=[],i=0;e.length>i;i++)for(var s=0;e[i].safeBags.length>s;s++){var o=e[i].safeBags[s];(void 0===a||o.type===a)&&void 0!==o.attributes[t]&&o.attributes[t].indexOf(r)>=0&&n.push(o)}return n}function r(e,t,r,i){if(t=s.fromDer(t,r),t.tagClass!==s.Class.UNIVERSAL||t.type!==s.Type.SEQUENCE||t.constructed!==!0)throw{message:"PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo"};for(var c=0;t.value.length>c;c++){var l=t.value[c],f={},d=[];if(!s.validate(l,u,f,d))throw{message:"Cannot read ContentInfo.",errors:d};var p={encrypted:!1},h=null,g=f.content.value[0];switch(s.derToOid(f.contentType)){case o.oids.data:if(g.tagClass!==s.Class.UNIVERSAL||g.type!==s.Type.OCTETSTRING)throw{message:"PKCS#12 SafeContents Data is not an OCTET STRING."};h=g.value;break;case o.oids.encryptedData:if(void 0===i)throw{message:"Found PKCS#12 Encrypted SafeContents Data but no password available."};h=a(g,i),p.encrypted=!0;break;default:throw{message:"Unsupported PKCS#12 contentType.",contentType:s.derToOid(f.contentType)}}p.safeBags=n(h,r,i),e.safeContents.push(p)}}function a(t,r){var a={},n=[];if(!s.validate(t,e.pkcs7.asn1.encryptedDataValidator,a,n))throw{message:"Cannot read EncryptedContentInfo. ",errors:n};var i=s.derToOid(a.contentType);if(i!==o.oids.data)throw{message:"PKCS#12 EncryptedContentInfo ContentType is not Data.",oid:i};i=s.derToOid(a.encAlgorithm);var c=o.pbe.getCipher(i,a.encParameter,r),u=e.util.createBuffer(a.encContent);if(c.update(u),!c.finish())throw{message:"Failed to decrypt PKCS#12 SafeContents."};return c.output.getBytes()}function n(e,t,r){if(e=s.fromDer(e,t),e.tagClass!==s.Class.UNIVERSAL||e.type!==s.Type.SEQUENCE||e.constructed!==!0)throw{message:"PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag"};for(var a=[],n=0;e.value.length>n;n++){var c=e.value[n],u={},l=[];if(!s.validate(c,f,u,l))throw{message:"Cannot read SafeBag.",errors:l};var d={type:s.derToOid(u.bagId),attributes:i(u.bagAttributes)};a.push(d);var h,g,y=u.bagValue.value[0];switch(d.type){case o.oids.pkcs8ShroudedKeyBag:if(void 0===r)throw{message:"Found PKCS#8 ShroudedKeyBag but no password available."};if(y=o.decryptPrivateKeyInfo(y,r),null===y)throw{message:"Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?"};case o.oids.keyBag:d.key=o.privateKeyFromAsn1(y);continue;case o.oids.certBag:h=p,g=function(){if(s.derToOid(u.certId)!==o.oids.x509Certificate)throw{message:"Unsupported certificate type, only X.509 supported.",oid:s.derToOid(u.certId)};d.cert=o.certificateFromAsn1(s.fromDer(u.cert,t),!0)};break;default:throw{message:"Unsupported PKCS#12 SafeBag type.",oid:d.type}}if(void 0!==h&&!s.validate(y,h,u,l))throw{message:"Cannot read PKCS#12 "+h.name,errors:l};g()}return a}function i(e){var t={};if(void 0!==e)for(var r=0;e.length>r;r++){var a={},n=[];if(!s.validate(e[r],d,a,n))throw{message:"Cannot read PKCS#12 BagAttribute.",errors:n};var i=s.derToOid(a.oid);if(void 0!==o.oids[i]){t[o.oids[i]]=[];for(var c=0;a.values.length>c;c++)t[o.oids[i]].push(a.values[c].value)}}return t}var s=e.asn1,o=e.pki,c=e.pkcs12=e.pkcs12||{},u={name:"ContentInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:s.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},l={name:"PFX",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"version"},u,{name:"PFX.macData",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:s.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},f={name:"SafeBag",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:s.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},d={name:"Attribute",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,constructed:!0,capture:"values"}]},p={name:"CertBag",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:s.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:s.Class.UNIVERSAL,type:s.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};c.pkcs12FromAsn1=function(a,n,i){"string"==typeof n?(i=n,n=!0):void 0===n&&(n=!0);var u={},f=[];if(!s.validate(a,l,u,f))throw{message:"Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.",errors:f};var d={version:u.version.charCodeAt(0),safeContents:[],getBagsByFriendlyName:function(e,r){return t(d.safeContents,"friendlyName",e,r)},getBagsByLocalKeyId:function(e,r){return t(d.safeContents,"localKeyId",e,r)}};if(3!==u.version.charCodeAt(0))throw{message:"PKCS#12 PFX of version other than 3 not supported.",version:u.version.charCodeAt(0)};if(s.derToOid(u.contentType)!==o.oids.data)throw{message:"Only PKCS#12 PFX in password integrity mode supported.",oid:s.derToOid(u.contentType)};var p=u.content.value[0];if(p.tagClass!==s.Class.UNIVERSAL||p.type!==s.Type.OCTETSTRING)throw{message:"PKCS#12 authSafe content data is not an OCTET STRING."};if(u.mac){var h=null,g=0,y=s.derToOid(u.macAlgorithm);switch(y){case o.oids.sha1:h=e.md.sha1.create(),g=20;break;case o.oids.sha256:h=e.md.sha256.create(),g=32;break;case o.oids.sha384:h=e.md.sha384.create(),g=48;break;case o.oids.sha512:h=e.md.sha512.create(),g=64;break;case o.oids.md5:h=e.md.md5.create(),g=16}if(null===h)throw{message:"PKCS#12 uses unsupported MAC algorithm: "+y};var m=new e.util.ByteBuffer(u.macSalt),v="macIterations"in u?parseInt(e.util.bytesToHex(u.macIterations),16):1,C=c.generateKey(i||"",m,3,v,g,h),E=e.hmac.create();E.start(h,C),E.update(p.value);var S=E.getMac();if(S.getBytes()!==u.macDigest)throw{message:"PKCS#12 MAC could not be verified. Invalid password?"}}return r(d,p.value,n,i),d},c.toPkcs12Asn1=function(t,r,a,n){n=n||{},n.saltSize=n.saltSize||8,n.count=n.count||2048,n.encAlgorithm=n.encAlgorithm||"aes128","useMac"in n||(n.useMac=!0),"localKeyId"in n||(n.localKeyId=null),"generateLocalKeyId"in n||(n.generateLocalKeyId=!0);var i=n.localKeyId,u=void 0;if(null!==i?i=e.util.hexToBytes(i):n.generateLocalKeyId&&(i=e.random.getBytes(20)),null!==i){var l=[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids.localKeyId).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SET,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,i)])])];u=s.create(s.Class.UNIVERSAL,s.Type.SET,!0,l)}var f=[],d=null;if(null!==t){var p=o.wrapRsaPrivateKey(o.privateKeyToAsn1(t));d=null===a?s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids.keyBag).getBytes()),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[p]),u]):s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids.pkcs8ShroudedKeyBag).getBytes()),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[o.encryptPrivateKeyInfo(p,a,n)]),u]);var h=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[d]),g=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids.data).getBytes()),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,s.toDer(h).getBytes())])]);f.push(g)}var y=[];null!==r&&(y=Array.isArray&&Array.isArray(r)||r.constructor===Array?r:[r]);for(var m=[],v=0;y.length>v;++v){r=y[v],"string"==typeof r&&(r=o.certificateFromPem(r));var C=0===v?u:void 0,E=o.certificateToAsn1(r),S=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids.certBag).getBytes()),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids.x509Certificate).getBytes()),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,s.toDer(E).getBytes())])])]),C]);m.push(S)}if(m.length>0){var T=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,m),I=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids.data).getBytes()),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,s.toDer(T).getBytes())])]);f.push(I)}var B=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,f),A=void 0;if(n.useMac){var b=e.md.sha1.create(),N=new e.util.ByteBuffer(e.random.getBytes(n.saltSize)),R=n.count,t=c.generateKey(a||"",N,3,R,20),k=e.hmac.create();k.start(b,t),k.update(s.toDer(B).getBytes());var U=k.getMac();A=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids.sha1).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,U.getBytes())]),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,N.getBytes()),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,e.util.hexToBytes(R.toString(16)))])}return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,String.fromCharCode(3)),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids.data).getBytes()),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,s.toDer(B).getBytes())])]),A])},c.generateKey=function(t,r,a,n,i,s){var o,c;(s===void 0||null===s)&&(s=e.md.sha1.create());var u=s.digestLength,l=s.blockLength,f=new e.util.ByteBuffer,d=new e.util.ByteBuffer;for(c=0;t.length>c;c++)d.putInt16(t.charCodeAt(c));d.putInt16(0);var p=d.length(),h=r.length(),g=new e.util.ByteBuffer;g.fillWithByte(a,l);var y=l*Math.ceil(h/l),m=new e.util.ByteBuffer;for(c=0;y>c;c++)m.putByte(r.at(c%h));var v=l*Math.ceil(p/l),C=new e.util.ByteBuffer;for(c=0;v>c;c++)C.putByte(d.at(c%p));var E=m;E.putBuffer(C);for(var S=Math.ceil(i/u),T=1;S>=T;T++){var I=new e.util.ByteBuffer;I.putBytes(g.bytes()),I.putBytes(E.bytes());for(var B=0;n>B;B++)s.start(),s.update(I.getBytes()),I=s.digest();var A=new e.util.ByteBuffer;for(c=0;l>c;c++)A.putByte(I.at(c%u));var b=Math.ceil(h/l)+Math.ceil(p/l),N=new e.util.ByteBuffer;for(o=0;b>o;o++){var R=new e.util.ByteBuffer(E.getBytes(l)),k=511;for(c=A.length()-1;c>=0;c--)k>>=8,k+=A.at(c)+R.at(c),R.setAt(c,255&k);N.putBuffer(R)}E=N,f.putBuffer(I)}return f.truncate(f.length()-i),f}}var t="pkcs12",r=["./asn1","./sha1","./pkcs7asn1","./pki","./util","./random","./hmac"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){function t(e,t,r){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function r(){return new t(null)}function a(e,t,r,a,n,i){for(;--i>=0;){var s=t*this.data[e++]+r.data[a]+n;n=Math.floor(s/67108864),r.data[a++]=67108863&s}return n}function n(e,t,r,a,n,i){for(var s=32767&t,o=t>>15;--i>=0;){var c=32767&this.data[e],u=this.data[e++]>>15,l=o*c+u*s;c=s*c+((32767&l)<<15)+r.data[a]+(1073741823&n),n=(c>>>30)+(l>>>15)+o*u+(n>>>30),r.data[a++]=1073741823&c}return n}function i(e,t,r,a,n,i){for(var s=16383&t,o=t>>14;--i>=0;){var c=16383&this.data[e],u=this.data[e++]>>14,l=o*c+u*s;c=s*c+((16383&l)<<14)+r.data[a]+n,n=(c>>28)+(l>>14)+o*u,r.data[a++]=268435455&c}return n}function s(e){return nr.charAt(e)}function o(e,t){var r=ir[e.charCodeAt(t)];return null==r?-1:r}function c(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s}function u(e){this.t=1,this.s=0>e?-1:0,e>0?this.data[0]=e:-1>e?this.data[0]=e+DV:this.t=0}function l(e){var t=r();return t.fromInt(e),t}function f(e,r){var a;if(16==r)a=4;else if(8==r)a=3;else if(256==r)a=8;else if(2==r)a=1;else if(32==r)a=5;else{if(4!=r)return this.fromRadix(e,r),void 0;a=2}this.t=0,this.s=0;for(var n=e.length,i=!1,s=0;--n>=0;){var c=8==a?255&e[n]:o(e,n);0>c?"-"==e.charAt(n)&&(i=!0):(i=!1,0==s?this.data[this.t++]=c:s+a>this.DB?(this.data[this.t-1]|=(c&(1<<this.DB-s)-1)<<s,this.data[this.t++]=c>>this.DB-s):this.data[this.t-1]|=c<<s,s+=a,s>=this.DB&&(s-=this.DB))}8==a&&0!=(128&e[0])&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&t.ZERO.subTo(this,this)}function d(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t}function p(e){if(0>this.s)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,a=(1<<t)-1,n=!1,i="",o=this.t,c=this.DB-o*this.DB%t;if(o-->0)for(this.DB>c&&(r=this.data[o]>>c)>0&&(n=!0,i=s(r));o>=0;)t>c?(r=(this.data[o]&(1<<c)-1)<<t-c,r|=this.data[--o]>>(c+=this.DB-t)):(r=this.data[o]>>(c-=t)&a,0>=c&&(c+=this.DB,--o)),r>0&&(n=!0),n&&(i+=s(r));return n?i:"0"}function h(){var e=r();return t.ZERO.subTo(this,e),e}function g(){return 0>this.s?this.negate():this}function y(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(t=r-e.t,0!=t)return t;for(;--r>=0;)if(0!=(t=this.data[r]-e.data[r]))return t;return 0}function m(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function v(){return 0>=this.t?0:this.DB*(this.t-1)+m(this.data[this.t-1]^this.s&this.DM)}function C(e,t){var r;for(r=this.t-1;r>=0;--r)t.data[r+e]=this.data[r];for(r=e-1;r>=0;--r)t.data[r]=0;t.t=this.t+e,t.s=this.s}function E(e,t){for(var r=e;this.t>r;++r)t.data[r-e]=this.data[r];t.t=Math.max(this.t-e,0),t.s=this.s}function S(e,t){var r,a=e%this.DB,n=this.DB-a,i=(1<<n)-1,s=Math.floor(e/this.DB),o=this.s<<a&this.DM;for(r=this.t-1;r>=0;--r)t.data[r+s+1]=this.data[r]>>n|o,o=(this.data[r]&i)<<a;for(r=s-1;r>=0;--r)t.data[r]=0;t.data[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function T(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)return t.t=0,void 0;var a=e%this.DB,n=this.DB-a,i=(1<<a)-1;t.data[0]=this.data[r]>>a;for(var s=r+1;this.t>s;++s)t.data[s-r-1]|=(this.data[s]&i)<<n,t.data[s-r]=this.data[s]>>a;a>0&&(t.data[this.t-r-1]|=(this.s&i)<<n),t.t=this.t-r,t.clamp()}function I(e,t){for(var r=0,a=0,n=Math.min(e.t,this.t);n>r;)a+=this.data[r]-e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a-=e.s;this.t>r;)a+=this.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;e.t>r;)a-=e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a-=e.s}t.s=0>a?-1:0,-1>a?t.data[r++]=this.DV+a:a>0&&(t.data[r++]=a),t.t=r,t.clamp()}function B(e,r){var a=this.abs(),n=e.abs(),i=a.t;for(r.t=i+n.t;--i>=0;)r.data[i]=0;for(i=0;n.t>i;++i)r.data[i+a.t]=a.am(0,n.data[i],r,i,0,a.t);r.s=0,r.clamp(),this.s!=e.s&&t.ZERO.subTo(r,r)}function A(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e.data[r]=0;for(r=0;t.t-1>r;++r){var a=t.am(r,t.data[r],e,2*r,0,1);(e.data[r+t.t]+=t.am(r+1,2*t.data[r],e,2*r+1,a,t.t-r-1))>=t.DV&&(e.data[r+t.t]-=t.DV,e.data[r+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(r,t.data[r],e,2*r,0,1)),e.s=0,e.clamp()}function b(e,a,n){var i=e.abs();if(!(0>=i.t)){var s=this.abs();if(s.t<i.t)return null!=a&&a.fromInt(0),null!=n&&this.copyTo(n),void 0;null==n&&(n=r());var o=r(),c=this.s,u=e.s,l=this.DB-m(i.data[i.t-1]);l>0?(i.lShiftTo(l,o),s.lShiftTo(l,n)):(i.copyTo(o),s.copyTo(n));var f=o.t,d=o.data[f-1];if(0!=d){var p=d*(1<<this.F1)+(f>1?o.data[f-2]>>this.F2:0),h=this.FV/p,g=(1<<this.F1)/p,y=1<<this.F2,v=n.t,C=v-f,E=null==a?r():a;for(o.dlShiftTo(C,E),n.compareTo(E)>=0&&(n.data[n.t++]=1,n.subTo(E,n)),t.ONE.dlShiftTo(f,E),E.subTo(o,o);f>o.t;)o.data[o.t++]=0;for(;--C>=0;){var S=n.data[--v]==d?this.DM:Math.floor(n.data[v]*h+(n.data[v-1]+y)*g);if(S>(n.data[v]+=o.am(0,S,n,C,0,f)))for(o.dlShiftTo(C,E),n.subTo(E,n);n.data[v]<--S;)n.subTo(E,n)}null!=a&&(n.drShiftTo(f,a),c!=u&&t.ZERO.subTo(a,a)),n.t=f,n.clamp(),l>0&&n.rShiftTo(l,n),0>c&&t.ZERO.subTo(n,n)}}}function N(e){var a=r();return this.abs().divRemTo(e,null,a),0>this.s&&a.compareTo(t.ZERO)>0&&e.subTo(a,a),a}function R(e){this.m=e}function k(e){return 0>e.s||e.compareTo(this.m)>=0?e.mod(this.m):e}function U(e){return e}function D(e){e.divRemTo(this.m,null,e)}function L(e,t,r){e.multiplyTo(t,r),this.reduce(r)}function _(e,t){e.squareTo(t),this.reduce(t)}function w(){if(1>this.t)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return t=15&t*(2-(15&e)*t),t=255&t*(2-(255&e)*t),t=65535&t*(2-(65535&(65535&e)*t)),t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function V(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function P(e){var a=r();return e.abs().dlShiftTo(this.m.t,a),a.divRemTo(this.m,null,a),0>e.s&&a.compareTo(t.ZERO)>0&&this.m.subTo(a,a),a}function O(e){var t=r();return e.copyTo(t),this.reduce(t),t}function x(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;this.m.t>t;++t){var r=32767&e.data[t],a=r*this.mpl+((r*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e.data[r]+=this.m.am(0,a,e,t,0,this.m.t);e.data[r]>=e.DV;)e.data[r]-=e.DV,e.data[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function K(e,t){e.squareTo(t),this.reduce(t)}function q(e,t,r){e.multiplyTo(t,r),this.reduce(r)}function F(){return 0==(this.t>0?1&this.data[0]:this.s)}function M(e,a){if(e>4294967295||1>e)return t.ONE;var n=r(),i=r(),s=a.convert(this),o=m(e)-1;for(s.copyTo(n);--o>=0;)if(a.sqrTo(n,i),(e&1<<o)>0)a.mulTo(i,s,n);else{var c=n;n=i,i=c}return a.revert(n)}function G(e,t){var r;return r=256>e||t.isEven()?new R(t):new V(t),this.exp(e,r)}function j(){var e=r();return this.copyTo(e),e}function Q(){if(0>this.s){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function H(){return 0==this.t?this.s:this.data[0]<<24>>24}function X(){return 0==this.t?this.s:this.data[0]<<16>>16}function W(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function z(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this.data[0]?0:1}function Z(e){if(null==e&&(e=10),0==this.signum()||2>e||e>36)return"0";var t=this.chunkSize(e),a=Math.pow(e,t),n=l(a),i=r(),s=r(),o="";for(this.divRemTo(n,i,s);i.signum()>0;)o=(a+s.intValue()).toString(e).substr(1)+o,i.divRemTo(n,i,s);return s.intValue().toString(e)+o}function Y(e,r){this.fromInt(0),null==r&&(r=10);for(var a=this.chunkSize(r),n=Math.pow(r,a),i=!1,s=0,c=0,u=0;e.length>u;++u){var l=o(e,u);0>l?"-"==e.charAt(u)&&0==this.signum()&&(i=!0):(c=r*c+l,++s>=a&&(this.dMultiply(n),this.dAddOffset(c,0),s=0,c=0))}s>0&&(this.dMultiply(Math.pow(r,s)),this.dAddOffset(c,0)),i&&t.ZERO.subTo(this,this)}function J(e,r,a){if("number"==typeof r)if(2>e)this.fromInt(1);else for(this.fromNumber(e,a),this.testBit(e-1)||this.bitwiseTo(t.ONE.shiftLeft(e-1),st,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(t.ONE.shiftLeft(e-1),this);else{var n=[],i=7&e;n.length=(e>>3)+1,r.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}}function $(){var e=this.t,t=[];t[0]=this.s;var r,a=this.DB-e*this.DB%8,n=0;if(e-->0)for(this.DB>a&&(r=this.data[e]>>a)!=(this.s&this.DM)>>a&&(t[n++]=r|this.s<<this.DB-a);e>=0;)8>a?(r=(this.data[e]&(1<<a)-1)<<8-a,r|=this.data[--e]>>(a+=this.DB-8)):(r=255&this.data[e]>>(a-=8),0>=a&&(a+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==n&&(128&this.s)!=(128&r)&&++n,(n>0||r!=this.s)&&(t[n++]=r);return t}function et(e){return 0==this.compareTo(e)}function tt(e){return 0>this.compareTo(e)?this:e}function rt(e){return this.compareTo(e)>0?this:e}function at(e,t,r){var a,n,i=Math.min(e.t,this.t);for(a=0;i>a;++a)r.data[a]=t(this.data[a],e.data[a]);if(e.t<this.t){for(n=e.s&this.DM,a=i;this.t>a;++a)r.data[a]=t(this.data[a],n);r.t=this.t}else{for(n=this.s&this.DM,a=i;e.t>a;++a)r.data[a]=t(n,e.data[a]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()}function nt(e,t){return e&t}function it(e){var t=r();return this.bitwiseTo(e,nt,t),t}function st(e,t){return e|t}function ot(e){var t=r();return this.bitwiseTo(e,st,t),t}function ct(e,t){return e^t}function ut(e){var t=r();return this.bitwiseTo(e,ct,t),t}function lt(e,t){return e&~t}function ft(e){var t=r();return this.bitwiseTo(e,lt,t),t}function dt(){for(var e=r(),t=0;this.t>t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e}function pt(e){var t=r();return 0>e?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function ht(e){var t=r();return 0>e?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function gt(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function yt(){for(var e=0;this.t>e;++e)if(0!=this.data[e])return e*this.DB+gt(this.data[e]);return 0>this.s?this.t*this.DB:-1}function mt(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function vt(){for(var e=0,t=this.s&this.DM,r=0;this.t>r;++r)e+=mt(this.data[r]^t);return e}function Ct(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)}function Et(e,r){var a=t.ONE.shiftLeft(e);return this.bitwiseTo(a,r,a),a}function St(e){return this.changeBit(e,st)}function Tt(e){return this.changeBit(e,lt)}function It(e){return this.changeBit(e,ct)}function Bt(e,t){for(var r=0,a=0,n=Math.min(e.t,this.t);n>r;)a+=this.data[r]+e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a+=e.s;this.t>r;)a+=this.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;e.t>r;)a+=e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a+=e.s}t.s=0>a?-1:0,a>0?t.data[r++]=a:-1>a&&(t.data[r++]=this.DV+a),t.t=r,t.clamp()}function At(e){var t=r();return this.addTo(e,t),t}function bt(e){var t=r();return this.subTo(e,t),t}function Nt(e){var t=r();return this.multiplyTo(e,t),t}function Rt(e){var t=r();return this.divRemTo(e,t,null),t}function kt(e){var t=r();return this.divRemTo(e,null,t),t}function Ut(e){var t=r(),a=r();return this.divRemTo(e,t,a),[t,a]}function Dt(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function Lt(e,t){if(0!=e){for(;t>=this.t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}}function _t(){}function wt(e){return e}function Vt(e,t,r){e.multiplyTo(t,r)}function Pt(e,t){e.squareTo(t)}function Ot(e){return this.exp(e,new _t)}function xt(e,t,r){var a=Math.min(this.t+e.t,t);
for(r.s=0,r.t=a;a>0;)r.data[--a]=0;var n;for(n=r.t-this.t;n>a;++a)r.data[a+this.t]=this.am(0,e.data[a],r,a,0,this.t);for(n=Math.min(e.t,t);n>a;++a)this.am(0,e.data[a],r,a,0,t-a);r.clamp()}function Kt(e,t,r){--t;var a=r.t=this.t+e.t-t;for(r.s=0;--a>=0;)r.data[a]=0;for(a=Math.max(t-this.t,0);e.t>a;++a)r.data[this.t+a-t]=this.am(t-a,e.data[a],r,0,0,this.t+a-t);r.clamp(),r.drShiftTo(1,r)}function qt(e){this.r2=r(),this.q3=r(),t.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function Ft(e){if(0>e.s||e.t>2*this.m.t)return e.mod(this.m);if(0>e.compareTo(this.m))return e;var t=r();return e.copyTo(t),this.reduce(t),t}function Mt(e){return e}function Gt(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>e.compareTo(this.r2);)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function jt(e,t){e.squareTo(t),this.reduce(t)}function Qt(e,t,r){e.multiplyTo(t,r),this.reduce(r)}function Ht(e,t){var a,n,i=e.bitLength(),s=l(1);if(0>=i)return s;a=18>i?1:48>i?3:144>i?4:768>i?5:6,n=8>i?new R(t):t.isEven()?new qt(t):new V(t);var o=[],c=3,u=a-1,f=(1<<a)-1;if(o[1]=n.convert(this),a>1){var d=r();for(n.sqrTo(o[1],d);f>=c;)o[c]=r(),n.mulTo(d,o[c-2],o[c]),c+=2}var p,h,g=e.t-1,y=!0,v=r();for(i=m(e.data[g])-1;g>=0;){for(i>=u?p=e.data[g]>>i-u&f:(p=(e.data[g]&(1<<i+1)-1)<<u-i,g>0&&(p|=e.data[g-1]>>this.DB+i-u)),c=a;0==(1&p);)p>>=1,--c;if(0>(i-=c)&&(i+=this.DB,--g),y)o[p].copyTo(s),y=!1;else{for(;c>1;)n.sqrTo(s,v),n.sqrTo(v,s),c-=2;c>0?n.sqrTo(s,v):(h=s,s=v,v=h),n.mulTo(v,o[p],s)}for(;g>=0&&0==(e.data[g]&1<<i);)n.sqrTo(s,v),h=s,s=v,v=h,0>--i&&(i=this.DB-1,--g)}return n.revert(s)}function Xt(e){var t=0>this.s?this.negate():this.clone(),r=0>e.s?e.negate():e.clone();if(0>t.compareTo(r)){var a=t;t=r,r=a}var n=t.getLowestSetBit(),i=r.getLowestSetBit();if(0>i)return t;for(i>n&&(i=n),i>0&&(t.rShiftTo(i,t),r.rShiftTo(i,r));t.signum()>0;)(n=t.getLowestSetBit())>0&&t.rShiftTo(n,t),(n=r.getLowestSetBit())>0&&r.rShiftTo(n,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return i>0&&r.lShiftTo(i,r),r}function Wt(e){if(0>=e)return 0;var t=this.DV%e,r=0>this.s?e-1:0;if(this.t>0)if(0==t)r=this.data[0]%e;else for(var a=this.t-1;a>=0;--a)r=(t*r+this.data[a])%e;return r}function zt(e){var r=e.isEven();if(this.isEven()&&r||0==e.signum())return t.ZERO;for(var a=e.clone(),n=this.clone(),i=l(1),s=l(0),o=l(0),c=l(1);0!=a.signum();){for(;a.isEven();)a.rShiftTo(1,a),r?(i.isEven()&&s.isEven()||(i.addTo(this,i),s.subTo(e,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),r?(o.isEven()&&c.isEven()||(o.addTo(this,o),c.subTo(e,c)),o.rShiftTo(1,o)):c.isEven()||c.subTo(e,c),c.rShiftTo(1,c);a.compareTo(n)>=0?(a.subTo(n,a),r&&i.subTo(o,i),s.subTo(c,s)):(n.subTo(a,n),r&&o.subTo(i,o),c.subTo(s,c))}return 0!=n.compareTo(t.ONE)?t.ZERO:c.compareTo(e)>=0?c.subtract(e):0>c.signum()?(c.addTo(e,c),0>c.signum()?c.add(e):c):c}function Zt(e){var t,r=this.abs();if(1==r.t&&r.data[0]<=sr[sr.length-1]){for(t=0;sr.length>t;++t)if(r.data[0]==sr[t])return!0;return!1}if(r.isEven())return!1;for(t=1;sr.length>t;){for(var a=sr[t],n=t+1;sr.length>n&&or>a;)a*=sr[n++];for(a=r.modInt(a);n>t;)if(0==a%sr[t++])return!1}return r.millerRabin(e)}function Yt(e){var a=this.subtract(t.ONE),n=a.getLowestSetBit();if(0>=n)return!1;var i=a.shiftRight(n);e=e+1>>1,e>sr.length&&(e=sr.length);for(var s=r(),o=0;e>o;++o){s.fromInt(sr[o]);var c=s.modPow(i,this);if(0!=c.compareTo(t.ONE)&&0!=c.compareTo(a)){for(var u=1;n>u++&&0!=c.compareTo(a);)if(c=c.modPowInt(2,this),0==c.compareTo(t.ONE))return!1;if(0!=c.compareTo(a))return!1}}return!0}var Jt,$t=0xdeadbeefcafe,er=15715070==(16777215&$t);"undefined"==typeof navigator?(t.prototype.am=i,Jt=28):er&&"Microsoft Internet Explorer"==navigator.appName?(t.prototype.am=n,Jt=30):er&&"Netscape"!=navigator.appName?(t.prototype.am=a,Jt=26):(t.prototype.am=i,Jt=28),t.prototype.DB=Jt,t.prototype.DM=(1<<Jt)-1,t.prototype.DV=1<<Jt;var tr=52;t.prototype.FV=Math.pow(2,tr),t.prototype.F1=tr-Jt,t.prototype.F2=2*Jt-tr;var rr,ar,nr="0123456789abcdefghijklmnopqrstuvwxyz",ir=[];for(rr="0".charCodeAt(0),ar=0;9>=ar;++ar)ir[rr++]=ar;for(rr="a".charCodeAt(0),ar=10;36>ar;++ar)ir[rr++]=ar;for(rr="A".charCodeAt(0),ar=10;36>ar;++ar)ir[rr++]=ar;R.prototype.convert=k,R.prototype.revert=U,R.prototype.reduce=D,R.prototype.mulTo=L,R.prototype.sqrTo=_,V.prototype.convert=P,V.prototype.revert=O,V.prototype.reduce=x,V.prototype.mulTo=q,V.prototype.sqrTo=K,t.prototype.copyTo=c,t.prototype.fromInt=u,t.prototype.fromString=f,t.prototype.clamp=d,t.prototype.dlShiftTo=C,t.prototype.drShiftTo=E,t.prototype.lShiftTo=S,t.prototype.rShiftTo=T,t.prototype.subTo=I,t.prototype.multiplyTo=B,t.prototype.squareTo=A,t.prototype.divRemTo=b,t.prototype.invDigit=w,t.prototype.isEven=F,t.prototype.exp=M,t.prototype.toString=p,t.prototype.negate=h,t.prototype.abs=g,t.prototype.compareTo=y,t.prototype.bitLength=v,t.prototype.mod=N,t.prototype.modPowInt=G,t.ZERO=l(0),t.ONE=l(1),_t.prototype.convert=wt,_t.prototype.revert=wt,_t.prototype.mulTo=Vt,_t.prototype.sqrTo=Pt,qt.prototype.convert=Ft,qt.prototype.revert=Mt,qt.prototype.reduce=Gt,qt.prototype.mulTo=Qt,qt.prototype.sqrTo=jt;var sr=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],or=(1<<26)/sr[sr.length-1];t.prototype.chunkSize=W,t.prototype.toRadix=Z,t.prototype.fromRadix=Y,t.prototype.fromNumber=J,t.prototype.bitwiseTo=at,t.prototype.changeBit=Et,t.prototype.addTo=Bt,t.prototype.dMultiply=Dt,t.prototype.dAddOffset=Lt,t.prototype.multiplyLowerTo=xt,t.prototype.multiplyUpperTo=Kt,t.prototype.modInt=Wt,t.prototype.millerRabin=Yt,t.prototype.clone=j,t.prototype.intValue=Q,t.prototype.byteValue=H,t.prototype.shortValue=X,t.prototype.signum=z,t.prototype.toByteArray=$,t.prototype.equals=et,t.prototype.min=tt,t.prototype.max=rt,t.prototype.and=it,t.prototype.or=ot,t.prototype.xor=ut,t.prototype.andNot=ft,t.prototype.not=dt,t.prototype.shiftLeft=pt,t.prototype.shiftRight=ht,t.prototype.getLowestSetBit=yt,t.prototype.bitCount=vt,t.prototype.testBit=Ct,t.prototype.setBit=St,t.prototype.clearBit=Tt,t.prototype.flipBit=It,t.prototype.add=At,t.prototype.subtract=bt,t.prototype.multiply=Nt,t.prototype.divide=Rt,t.prototype.remainder=kt,t.prototype.divideAndRemainder=Ut,t.prototype.modPow=Ht,t.prototype.modInverse=zt,t.prototype.pow=Ot,t.prototype.gcd=Xt,t.prototype.isProbablePrime=Zt,e.jsbn=e.jsbn||{},e.jsbn.BigInteger=t}var t="jsbn",r=[],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){e.pki=e.pki||{};var t=e.pki.oids=e.oids=e.oids||{};t["1.2.840.113549.1.1.1"]="rsaEncryption",t.rsaEncryption="1.2.840.113549.1.1.1",t["1.2.840.113549.1.1.4"]="md5withRSAEncryption",t.md5withRSAEncryption="1.2.840.113549.1.1.4",t["1.2.840.113549.1.1.5"]="sha1withRSAEncryption",t.sha1withRSAEncryption="1.2.840.113549.1.1.5",t["1.2.840.113549.1.1.7"]="RSAES-OAEP",t["RSAES-OAEP"]="1.2.840.113549.1.1.7",t["1.2.840.113549.1.1.8"]="mgf1",t.mgf1="1.2.840.113549.1.1.8",t["1.2.840.113549.1.1.9"]="pSpecified",t.pSpecified="1.2.840.113549.1.1.9",t["1.2.840.113549.1.1.10"]="RSASSA-PSS",t["RSASSA-PSS"]="1.2.840.113549.1.1.10",t["1.2.840.113549.1.1.11"]="sha256WithRSAEncryption",t.sha256WithRSAEncryption="1.2.840.113549.1.1.11",t["1.2.840.113549.1.1.12"]="sha384WithRSAEncryption",t.sha384WithRSAEncryption="1.2.840.113549.1.1.12",t["1.2.840.113549.1.1.13"]="sha512WithRSAEncryption",t.sha512WithRSAEncryption="1.2.840.113549.1.1.13",t["1.3.14.3.2.26"]="sha1",t.sha1="1.3.14.3.2.26",t["2.16.840.1.101.3.4.2.1"]="sha256",t.sha256="2.16.840.1.101.3.4.2.1",t["2.16.840.1.101.3.4.2.2"]="sha384",t.sha384="2.16.840.1.101.3.4.2.2",t["2.16.840.1.101.3.4.2.3"]="sha512",t.sha512="2.16.840.1.101.3.4.2.3",t["1.2.840.113549.2.5"]="md5",t.md5="1.2.840.113549.2.5",t["1.2.840.113549.1.7.1"]="data",t.data="1.2.840.113549.1.7.1",t["1.2.840.113549.1.7.2"]="signedData",t.signedData="1.2.840.113549.1.7.2",t["1.2.840.113549.1.7.3"]="envelopedData",t.envelopedData="1.2.840.113549.1.7.3",t["1.2.840.113549.1.7.4"]="signedAndEnvelopedData",t.signedAndEnvelopedData="1.2.840.113549.1.7.4",t["1.2.840.113549.1.7.5"]="digestedData",t.digestedData="1.2.840.113549.1.7.5",t["1.2.840.113549.1.7.6"]="encryptedData",t.encryptedData="1.2.840.113549.1.7.6",t["1.2.840.113549.1.9.20"]="friendlyName",t.friendlyName="1.2.840.113549.1.9.20",t["1.2.840.113549.1.9.21"]="localKeyId",t.localKeyId="1.2.840.113549.1.9.21",t["1.2.840.113549.1.9.22.1"]="x509Certificate",t.x509Certificate="1.2.840.113549.1.9.22.1",t["1.2.840.113549.1.9.4"]="messageDigest",t.messageDigest="1.2.840.113549.1.9.4",t["1.2.840.113549.1.9.3"]="contentType",t.contentType="1.2.840.113549.1.9.3",t["1.2.840.113549.1.9.5"]="signingTime",t.signingTime="1.2.840.113549.1.9.5",t["1.2.840.113549.1.12.10.1.1"]="keyBag",t.keyBag="1.2.840.113549.1.12.10.1.1",t["1.2.840.113549.1.12.10.1.2"]="pkcs8ShroudedKeyBag",t.pkcs8ShroudedKeyBag="1.2.840.113549.1.12.10.1.2",t["1.2.840.113549.1.12.10.1.3"]="certBag",t.certBag="1.2.840.113549.1.12.10.1.3",t["1.2.840.113549.1.12.10.1.4"]="crlBag",t.crlBag="1.2.840.113549.1.12.10.1.4",t["1.2.840.113549.1.12.10.1.5"]="secretBag",t.secretBag="1.2.840.113549.1.12.10.1.5",t["1.2.840.113549.1.12.10.1.6"]="safeContentsBag",t.safeContentsBag="1.2.840.113549.1.12.10.1.6",t["1.2.840.113549.1.5.13"]="pkcs5PBES2",t.pkcs5PBES2="1.2.840.113549.1.5.13",t["1.2.840.113549.1.5.12"]="pkcs5PBKDF2",t.pkcs5PBKDF2="1.2.840.113549.1.5.12",t["1.2.840.113549.1.12.1.1"]="pbeWithSHAAnd128BitRC4",t.pbeWithSHAAnd128BitRC4="1.2.840.113549.1.12.1.1",t["1.2.840.113549.1.12.1.2"]="pbeWithSHAAnd40BitRC4",t.pbeWithSHAAnd40BitRC4="1.2.840.113549.1.12.1.2",t["1.2.840.113549.1.12.1.3"]="pbeWithSHAAnd3-KeyTripleDES-CBC",t["pbeWithSHAAnd3-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.3",t["1.2.840.113549.1.12.1.4"]="pbeWithSHAAnd2-KeyTripleDES-CBC",t["pbeWithSHAAnd2-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.4",t["1.2.840.113549.1.12.1.5"]="pbeWithSHAAnd128BitRC2-CBC",t["pbeWithSHAAnd128BitRC2-CBC"]="1.2.840.113549.1.12.1.5",t["1.2.840.113549.1.12.1.6"]="pbewithSHAAnd40BitRC2-CBC",t["pbewithSHAAnd40BitRC2-CBC"]="1.2.840.113549.1.12.1.6",t["1.2.840.113549.3.7"]="des-EDE3-CBC",t["des-EDE3-CBC"]="1.2.840.113549.3.7",t["2.16.840.1.101.3.4.1.2"]="aes128-CBC",t["aes128-CBC"]="2.16.840.1.101.3.4.1.2",t["2.16.840.1.101.3.4.1.22"]="aes192-CBC",t["aes192-CBC"]="2.16.840.1.101.3.4.1.22",t["2.16.840.1.101.3.4.1.42"]="aes256-CBC",t["aes256-CBC"]="2.16.840.1.101.3.4.1.42",t["2.5.4.3"]="commonName",t.commonName="2.5.4.3",t["2.5.4.5"]="serialName",t.serialName="2.5.4.5",t["2.5.4.6"]="countryName",t.countryName="2.5.4.6",t["2.5.4.7"]="localityName",t.localityName="2.5.4.7",t["2.5.4.8"]="stateOrProvinceName",t.stateOrProvinceName="2.5.4.8",t["2.5.4.10"]="organizationName",t.organizationName="2.5.4.10",t["2.5.4.11"]="organizationalUnitName",t.organizationalUnitName="2.5.4.11",t["1.2.840.113549.1.9.1"]="emailAddress",t.emailAddress="1.2.840.113549.1.9.1",t["2.5.29.1"]="authorityKeyIdentifier",t["2.5.29.2"]="keyAttributes",t["2.5.29.3"]="certificatePolicies",t["2.5.29.4"]="keyUsageRestriction",t["2.5.29.5"]="policyMapping",t["2.5.29.6"]="subtreesConstraint",t["2.5.29.7"]="subjectAltName",t["2.5.29.8"]="issuerAltName",t["2.5.29.9"]="subjectDirectoryAttributes",t["2.5.29.10"]="basicConstraints",t["2.5.29.11"]="nameConstraints",t["2.5.29.12"]="policyConstraints",t["2.5.29.13"]="basicConstraints",t["2.5.29.14"]="subjectKeyIdentifier",t.subjectKeyIdentifier="2.5.29.14",t["2.5.29.15"]="keyUsage",t.keyUsage="2.5.29.15",t["2.5.29.16"]="privateKeyUsagePeriod",t["2.5.29.17"]="subjectAltName",t.subjectAltName="2.5.29.17",t["2.5.29.18"]="issuerAltName",t.issuerAltName="2.5.29.18",t["2.5.29.19"]="basicConstraints",t.basicConstraints="2.5.29.19",t["2.5.29.20"]="cRLNumber",t["2.5.29.21"]="cRLReason",t["2.5.29.22"]="expirationDate",t["2.5.29.23"]="instructionCode",t["2.5.29.24"]="invalidityDate",t["2.5.29.25"]="cRLDistributionPoints",t["2.5.29.26"]="issuingDistributionPoint",t["2.5.29.27"]="deltaCRLIndicator",t["2.5.29.28"]="issuingDistributionPoint",t["2.5.29.29"]="certificateIssuer",t["2.5.29.30"]="nameConstraints",t["2.5.29.31"]="cRLDistributionPoints",t["2.5.29.32"]="certificatePolicies",t["2.5.29.33"]="policyMappings",t["2.5.29.34"]="policyConstraints",t["2.5.29.35"]="authorityKeyIdentifier",t["2.5.29.36"]="policyConstraints",t["2.5.29.37"]="extKeyUsage",t.extKeyUsage="2.5.29.37",t["2.5.29.46"]="freshestCRL",t["2.5.29.54"]="inhibitAnyPolicy"}var t="oids",r=[],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){function t(t,r,a){function n(){return e.pki.rsa.stepKeyPairGenerationState(t,10)?a(null,t.keys):(e.util.setImmediate(n),void 0)}function i(){s(t.pBits,function(e,r){return e?a(e):(t.p=r,s(t.qBits,o),void 0)})}function s(e,r){function a(){var r=e-1,a=new BigInteger(e,t.rng);return a.testBit(r)||a.bitwiseTo(BigInteger.ONE.shiftLeft(r),p,a),a.dAddOffset(31-a.mod(d).byteValue(),0),a}function n(n){if(!g){--o;var s=n.data;if(s.found){for(var c=0;i.length>c;++c)i[c].terminate();return g=!0,r(null,new BigInteger(s.prime,16))}h.bitLength()>e&&(h=a());var f=h.toString(16);n.target.postMessage({e:t.eInt,hex:f,workLoad:u}),h.dAddOffset(l,0)}}for(var i=[],s=0;c>s;++s)i[s]=new Worker(f);for(var o=c,h=a(),s=0;c>s;++s)i[s].addEventListener("message",n);var g=!1}function o(r,n){if(t.q=n,0>t.p.compareTo(t.q)){var c=t.p;t.p=t.q,t.q=c}if(t.p1=t.p.subtract(BigInteger.ONE),t.q1=t.q.subtract(BigInteger.ONE),t.phi=t.p1.multiply(t.q1),0!==t.phi.gcd(t.e).compareTo(BigInteger.ONE))return t.p=t.q=null,i(),void 0;if(t.n=t.p.multiply(t.q),t.n.bitLength()!==t.bits)return t.q=null,s(t.qBits,o),void 0;var u=t.e.modInverse(t.phi);t.keys={privateKey:e.pki.rsa.setPrivateKey(t.n,t.e,u,t.p,t.q,u.mod(t.p1),u.mod(t.q1),t.q.modInverse(t.p)),publicKey:e.pki.rsa.setPublicKey(t.n,t.e)},a(null,t.keys)}if("function"==typeof r&&(a=r,r={}),"undefined"==typeof Worker)return n();var c=r.workers||2,u=r.workLoad||100,l=30*u/8,f=r.workerScript||"forge/prime.worker.js",d=new BigInteger(null);d.fromInt(30);var p=function(e,t){return e|t};i()}"object"==typeof module&&module.exports,"undefined"==typeof BigInteger&&(BigInteger=e.jsbn.BigInteger);var r=e.asn1;e.pki=e.pki||{},e.pki.rsa=e.rsa=e.rsa||{};var a=e.pki,n=[6,4,2,4,2,4,6,2],i=function(t){var a;if(!(t.algorithm in e.pki.oids))throw{message:"Unknown message digest algorithm.",algorithm:t.algorithm};a=e.pki.oids[t.algorithm];var n=r.oidToDer(a).getBytes(),i=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]),s=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]);s.value.push(r.create(r.Class.UNIVERSAL,r.Type.OID,!1,n)),s.value.push(r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,""));var o=r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,t.digest().getBytes());return i.value.push(s),i.value.push(o),r.toDer(i).getBytes()},s=function(e,t,r){var a;if(r)a=e.modPow(t.e,t.n);else{t.dP||(t.dP=t.d.mod(t.p.subtract(BigInteger.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(BigInteger.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));for(var n=e.mod(t.p).modPow(t.dP,t.p),i=e.mod(t.q).modPow(t.dQ,t.q);0>n.compareTo(i);)n=n.add(t.p);a=n.subtract(i).multiply(t.qInv).mod(t.p).multiply(t.q).add(i)}return a};a.rsa.encrypt=function(t,r,a){var n=a,i=e.util.createBuffer(),o=Math.ceil(r.n.bitLength()/8);if(a!==!1&&a!==!0){if(t.length>o-11)throw{message:"Message is too long to encrypt.",length:t.length,max:o-11};i.putByte(0),i.putByte(a);var c,u=o-3-t.length;if(0===a||1===a){n=!1,c=0===a?0:255;for(var l=0;u>l;++l)i.putByte(c)}else{n=!0;for(var l=0;u>l;++l)c=Math.floor(255*Math.random())+1,i.putByte(c)}i.putByte(0)}i.putBytes(t);for(var f=new BigInteger(i.toHex(),16),d=s(f,r,n),p=d.toString(16),h=e.util.createBuffer(),g=o-Math.ceil(p.length/2);g>0;)h.putByte(0),--g;return h.putBytes(e.util.hexToBytes(p)),h.getBytes()},a.rsa.decrypt=function(t,r,a,n){var i=Math.ceil(r.n.bitLength()/8);if(t.length!=i)throw{message:"Encrypted message length is invalid.",length:t.length,expected:i};for(var o=new BigInteger(e.util.createBuffer(t).toHex(),16),c=s(o,r,a),u=c.toString(16),l=e.util.createBuffer(),f=i-Math.ceil(u.length/2);f>0;)l.putByte(0),--f;if(l.putBytes(e.util.hexToBytes(u)),n!==!1){var d=l.getByte(),p=l.getByte();if(0!==d||a&&0!==p&&1!==p||!a&&2!=p||a&&0===p&&n===void 0)throw{message:"Encryption block is invalid."};var h=0;if(0===p){h=i-3-n;for(var g=0;h>g;++g)if(0!==l.getByte())throw{message:"Encryption block is invalid."}}else if(1===p)for(h=0;l.length()>1;){if(255!==l.getByte()){--l.read;break}++h}else if(2===p)for(h=0;l.length()>1;){if(0===l.getByte()){--l.read;break}++h}var y=l.getByte();if(0!==y||h!==i-3-l.length())throw{message:"Encryption block is invalid."}}return l.getBytes()},a.rsa.createKeyPairGenerationState=function(t,r){"string"==typeof t&&(t=parseInt(t,10)),t=t||1024;var a={nextBytes:function(t){for(var r=e.random.getBytes(t.length),a=0;t.length>a;++a)t[a]=r.charCodeAt(a)}},n={state:0,bits:t,rng:a,eInt:r||65537,e:new BigInteger(null),p:null,q:null,qBits:t>>1,pBits:t-(t>>1),pqState:0,num:null,keys:null};return n.e.fromInt(n.eInt),n},a.rsa.stepKeyPairGenerationState=function(t,r){var a=new BigInteger(null);a.fromInt(30);for(var i,s=0,o=function(e,t){return e|t},c=+new Date,u=0;null===t.keys&&(0>=r||r>u);){if(0===t.state){var l=null===t.p?t.pBits:t.qBits,f=l-1;0===t.pqState?(t.num=new BigInteger(l,t.rng),t.num.testBit(f)||t.num.bitwiseTo(BigInteger.ONE.shiftLeft(f),o,t.num),t.num.dAddOffset(31-t.num.mod(a).byteValue(),0),s=0,++t.pqState):1===t.pqState?t.num.bitLength()>l?t.pqState=0:t.num.isProbablePrime(1)?++t.pqState:t.num.dAddOffset(n[s++%8],0):2===t.pqState?t.pqState=0===t.num.subtract(BigInteger.ONE).gcd(t.e).compareTo(BigInteger.ONE)?3:0:3===t.pqState&&(t.pqState=0,t.num.isProbablePrime(10)&&(null===t.p?t.p=t.num:t.q=t.num,null!==t.p&&null!==t.q&&++t.state),t.num=null)}else if(1===t.state)0>t.p.compareTo(t.q)&&(t.num=t.p,t.p=t.q,t.q=t.num),++t.state;else if(2===t.state)t.p1=t.p.subtract(BigInteger.ONE),t.q1=t.q.subtract(BigInteger.ONE),t.phi=t.p1.multiply(t.q1),++t.state;else if(3===t.state)0===t.phi.gcd(t.e).compareTo(BigInteger.ONE)?++t.state:(t.p=null,t.q=null,t.state=0);else if(4===t.state)t.n=t.p.multiply(t.q),t.n.bitLength()===t.bits?++t.state:(t.q=null,t.state=0);else if(5===t.state){var d=t.e.modInverse(t.phi);t.keys={privateKey:e.pki.rsa.setPrivateKey(t.n,t.e,d,t.p,t.q,d.mod(t.p1),d.mod(t.q1),t.q.modInverse(t.p)),publicKey:e.pki.rsa.setPublicKey(t.n,t.e)}}i=+new Date,u+=i-c,c=i}return null!==t.keys},a.rsa.generateKeyPair=function(e,r,n,i){1===arguments.length?"object"==typeof e?(n=e,e=void 0):"function"==typeof e&&(i=e,e=void 0):2===arguments.length?("number"==typeof e?"function"==typeof r?i=r:n=r:(n=e,i=r,e=void 0),r=void 0):3===arguments.length&&("number"==typeof r?"function"==typeof n&&(i=n,n=void 0):(i=n,n=r,r=void 0)),n=n||{},void 0===e&&(e=n.bits||1024),void 0===r&&(r=n.e||65537);var s=a.rsa.createKeyPairGenerationState(e,r);return i?(t(s,n,i),void 0):(a.rsa.stepKeyPairGenerationState(s,0),s.keys)},a.rsa.setPublicKey=function(e,t){var n={n:e,e:t};return n.encrypt=function(e){return a.rsa.encrypt(e,n,2)},n.verify=function(e,t,i){var s=void 0===i?void 0:!1,o=a.rsa.decrypt(t,n,!0,s);if(void 0===i){var c=r.fromDer(o);return e===c.value[1].value}return i.verify(e,o,n.n.bitLength())},n},a.rsa.setPrivateKey=function(e,t,r,n,s,o,c,u){var l={n:e,e:t,d:r,p:n,q:s,dP:o,dQ:c,qInv:u};return l.decrypt=function(e){return a.rsa.decrypt(e,l,!1)},l.sign=function(e,t){var r=!1;void 0===t&&(t={encode:i},r=1);var n=t.encode(e,l.n.bitLength());return a.rsa.encrypt(n,l,r)},l}}var t="rsa",r=["./asn1","./oids","./random","./util","./jsbn"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){"undefined"==typeof BigInteger&&(BigInteger=e.jsbn.BigInteger);var t=e.asn1,r=e.pki=e.pki||{},a=r.oids;r.pbe={};var n={};n.CN=a.commonName,n.commonName="CN",n.C=a.countryName,n.countryName="C",n.L=a.localityName,n.localityName="L",n.ST=a.stateOrProvinceName,n.stateOrProvinceName="ST",n.O=a.organizationName,n.organizationName="O",n.OU=a.organizationalUnitName,n.organizationalUnitName="OU",n.E=a.emailAddress,n.emailAddress="E";var i={name:"SubjectPublicKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},s={name:"RSAPublicKey",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},o={name:"Certificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},i,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},c={name:"PrivateKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},u={name:"RSAPrivateKey",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},l={name:"EncryptedPrivateKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},f={name:"PBES2Algorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,onstructed:!0,capture:"kdfIterationCount"}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},d={name:"pkcs-12PbeParams",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"iterations"}]},p={name:"rsapss",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"trailer"}]}]};r.RDNAttributesAsArray=function(e,r){for(var i,s,o,c=[],u=0;e.value.length>u;++u){i=e.value[u];for(var l=0;i.value.length>l;++l)o={},s=i.value[l],o.type=t.derToOid(s.value[0].value),o.value=s.value[1].value,o.valueTagClass=s.value[1].type,o.type in a&&(o.name=a[o.type],o.name in n&&(o.shortName=n[o.name])),r&&(r.update(o.type),r.update(o.value)),c.push(o)}return c};var h=function(e,t){t.constructor==String&&(t={shortName:t});for(var r,a=null,n=0;null===a&&e.attributes.length>n;++n)r=e.attributes[n],t.type&&t.type===r.type?a=r:t.name&&t.name===r.name?a=r:t.shortName&&t.shortName===r.shortName&&(a=r);return a},g=function(r){for(var n,i,s,o=[],c=0;r.value.length>c;++c){s=r.value[c];for(var u=0;s.value.length>u;++u){if(i=s.value[u],n={},n.id=t.derToOid(i.value[0].value),n.critical=!1,i.value[1].type===t.Type.BOOLEAN?(n.critical=0!==i.value[1].value.charCodeAt(0),n.value=i.value[2].value):n.value=i.value[1].value,n.id in a)if(n.name=a[n.id],"keyUsage"===n.name){var l=t.fromDer(n.value),f=0,d=0;
l.value.length>1&&(f=l.value.charCodeAt(1),d=l.value.length>2?l.value.charCodeAt(2):0),n.digitalSignature=128==(128&f),n.nonRepudiation=64==(64&f),n.keyEncipherment=32==(32&f),n.dataEncipherment=16==(16&f),n.keyAgreement=8==(8&f),n.keyCertSign=4==(4&f),n.cRLSign=2==(2&f),n.encipherOnly=1==(1&f),n.decipherOnly=128==(128&d)}else if("basicConstraints"===n.name){var l=t.fromDer(n.value);if(n.cA=l.value.length>0?0!==l.value[0].value.charCodeAt(0):!1,l.value.length>1){var p=e.util.createBuffer(l.value[1].value);n.pathLenConstraint=p.getInt(p.length()<<3)}}else if("subjectAltName"===n.name||"issuerAltName"===n.name){n.altNames=[];for(var h,l=t.fromDer(n.value),g=0;l.value.length>g;++g){h=l.value[g];var y={type:h.type,value:h.value};switch(n.altNames.push(y),h.type){case 1:case 2:case 6:break;case 7:break;case 8:y.oid=t.derToOid(h.value);break;default:}}}o.push(n)}}return o},y=RegExp("-----BEGIN [^-]+-----([A-Za-z0-9+/=\\s]+)-----END [^-]+-----");r.pemToDer=function(t){var r=null,a=y.exec(t);if(!a)throw"Invalid PEM format";return r=e.util.createBuffer(e.util.decode64(a[1]))};var m=function(e,a,n){var i=null,s=r.pemToDer(e),o=t.fromDer(s,n);return i=a(o)},v=function(t){var r=t.toString(16);return r[0]>="8"&&(r="00"+r),e.util.hexToBytes(r)},C=function(e,r,n){var i={};if(e!==a["RSASSA-PSS"])return i;n&&(i={hash:{algorithmOid:a.sha1},mgf:{algorithmOid:a.mgf1,hash:{algorithmOid:a.sha1}},saltLength:20});var s={},o=[];if(!t.validate(r,p,s,o))throw{message:"Cannot read RSASSA-PSS parameter block.",errors:o};return void 0!==s.hashOid&&(i.hash=i.hash||{},i.hash.algorithmOid=t.derToOid(s.hashOid)),void 0!==s.maskGenOid&&(i.mgf=i.mgf||{},i.mgf.algorithmOid=t.derToOid(s.maskGenOid),i.mgf.hash=i.mgf.hash||{},i.mgf.hash.algorithmOid=t.derToOid(s.maskGenHashOid)),void 0!==s.saltLength&&(i.saltLength=s.saltLength.charCodeAt(0)),i};r.certificateFromPem=function(e,t,a){return m(e,function(e){return r.certificateFromAsn1(e,t)},a)},r.certificateToPem=function(a,n){var i=t.toDer(r.certificateToAsn1(a));return i=e.util.encode64(i.getBytes(),n||64),"-----BEGIN CERTIFICATE-----\r\n"+i+"\r\n-----END CERTIFICATE-----"},r.publicKeyFromPem=function(e){return m(e,r.publicKeyFromAsn1)},r.publicKeyToPem=function(a,n){var i=t.toDer(r.publicKeyToAsn1(a));return i=e.util.encode64(i.getBytes(),n||64),"-----BEGIN PUBLIC KEY-----\r\n"+i+"\r\n-----END PUBLIC KEY-----"},r.publicKeyToRSAPublicKeyPem=function(a,n){var i=t.toDer(r.publicKeyToRSAPublicKey(a));return i=e.util.encode64(i.getBytes(),n||64),"-----BEGIN RSA PUBLIC KEY-----\r\n"+i+"\r\n-----END RSA PUBLIC KEY-----"},r.privateKeyFromPem=function(e){return m(e,r.privateKeyFromAsn1)},r.privateKeyToPem=function(a,n){var i=t.toDer(r.privateKeyToAsn1(a));return i=e.util.encode64(i.getBytes(),n||64),"-----BEGIN RSA PRIVATE KEY-----\r\n"+i+"\r\n-----END RSA PRIVATE KEY-----"},r.createCertificate=function(){var i={};i.version=2,i.serialNumber="00",i.signatureOid=null,i.signature=null,i.siginfo={},i.siginfo.algorithmOid=null,i.validity={},i.validity.notBefore=new Date,i.validity.notAfter=new Date,i.issuer={},i.issuer.getField=function(e){return h(i.issuer,e)},i.issuer.addField=function(e){s([e]),i.issuer.attributes.push(e)},i.issuer.attributes=[],i.issuer.hash=null,i.subject={},i.subject.getField=function(e){return h(i.subject,e)},i.subject.addField=function(e){s([e]),i.subject.attributes.push(e)},i.subject.attributes=[],i.subject.hash=null,i.extensions=[],i.publicKey=null,i.md=null;var s=function(e){for(var t,a=0;e.length>a;++a){if(t=e[a],t.name===void 0&&(t.type&&t.type in r.oids?t.name=r.oids[t.type]:t.shortName&&t.shortName in n&&(t.name=r.oids[n[t.shortName]])),t.type===void 0){if(!(t.name&&t.name in r.oids))throw{message:"Attribute type not specified.",attribute:t};t.type=r.oids[t.name]}if(t.shortName===void 0&&t.name&&t.name in n&&(t.shortName=n[t.name]),t.value===void 0)throw{message:"Attribute value not specified.",attribute:t}}};return i.setSubject=function(e,t){s(e),i.subject.attributes=e,delete i.subject.uniqueId,t&&(i.subject.uniqueId=t),i.subject.hash=null},i.setIssuer=function(e,t){s(e),i.issuer.attributes=e,delete i.issuer.uniqueId,t&&(i.issuer.uniqueId=t),i.issuer.hash=null},i.setExtensions=function(a){for(var n,s=0;a.length>s;++s){if(n=a[s],n.name===void 0&&n.id&&n.id in r.oids&&(n.name=r.oids[n.id]),n.id===void 0){if(!(n.name&&n.name in r.oids))throw{message:"Extension ID not specified.",extension:n};n.id=r.oids[n.name]}if(n.value===void 0){if("keyUsage"===n.name){var o=0,c=0,u=0;n.digitalSignature&&(c|=128,o=7),n.nonRepudiation&&(c|=64,o=6),n.keyEncipherment&&(c|=32,o=5),n.dataEncipherment&&(c|=16,o=4),n.keyAgreement&&(c|=8,o=3),n.keyCertSign&&(c|=4,o=2),n.cRLSign&&(c|=2,o=1),n.encipherOnly&&(c|=1,o=0),n.decipherOnly&&(u|=128,o=7);var l=String.fromCharCode(o);0!==u?l+=String.fromCharCode(c)+String.fromCharCode(u):0!==c&&(l+=String.fromCharCode(c)),n.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,l)}else if("basicConstraints"===n.name){if(n.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),n.cA&&n.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255))),n.pathLenConstraint){var f=n.pathLenConstraint,d=e.util.createBuffer();d.putInt(f,f.toString(2).length),n.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,d.getBytes()))}}else if("subjectAltName"===n.name||"issuerAltName"===n.name){n.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var p,h=0;n.altNames.length>h;++h){p=n.altNames[h];var l=p.value;8===p.type&&(l=t.oidToDer(l)),n.value.value.push(t.create(t.Class.CONTEXT_SPECIFIC,p.type,!1,l))}}if(n.value===void 0)throw{message:"Extension value not specified.",extension:n}}}i.extensions=a},i.getExtension=function(e){e.constructor==String&&(e={name:e});for(var t,r=null,a=0;null===r&&i.extensions.length>a;++a)t=i.extensions[a],e.id&&t.id===e.id?r=t:e.name&&t.name===e.name&&(r=t);return r},i.sign=function(n){i.signatureOid=a.sha1withRSAEncryption,i.siginfo.algorithmOid=a.sha1withRSAEncryption,i.md=e.md.sha1.create(),i.tbsCertificate=r.getTBSCertificate(i);var s=t.toDer(i.tbsCertificate);i.md.update(s.getBytes()),i.signature=n.sign(i.md)},i.verify=function(n){var s=!1,o=n.md;if(null===o){if(i.signatureOid in a){var c=a[i.signatureOid];switch(c){case"sha1withRSAEncryption":o=e.md.sha1.create();break;case"md5withRSAEncryption":o=e.md.md5.create();break;case"sha256WithRSAEncryption":o=e.md.sha256.create();break;case"RSASSA-PSS":o=e.md.sha256.create()}}if(null===o)throw{message:"Could not compute certificate digest. Unknown signature OID.",signatureOid:i.signatureOid};var u=n.tbsCertificate||r.getTBSCertificate(n),l=t.toDer(u);o.update(l.getBytes())}if(null!==o){var f=void 0;switch(n.signatureOid){case a.sha1withRSAEncryption:f=void 0;break;case a["RSASSA-PSS"]:var d,p;if(d=a[n.signatureParameters.mgf.hash.algorithmOid],void 0===d||void 0===e.md[d])throw{message:"Unsupported MGF hash function.",oid:n.signatureParameters.mgf.hash.algorithmOid,name:d};if(p=a[n.signatureParameters.mgf.algorithmOid],void 0===p||void 0===e.mgf[p])throw{message:"Unsupported MGF function.",oid:n.signatureParameters.mgf.algorithmOid,name:p};if(p=e.mgf[p].create(e.md[d].create()),d=a[n.signatureParameters.hash.algorithmOid],void 0===d||void 0===e.md[d])throw{message:"Unsupported RSASSA-PSS hash function.",oid:n.signatureParameters.hash.algorithmOid,name:d};f=e.pss.create(e.md[d].create(),p,n.signatureParameters.saltLength)}s=i.publicKey.verify(o.digest().getBytes(),n.signature,f)}return s},i.isIssuer=function(e){var t=!1,r=i.issuer,a=e.subject;if(r.hash&&a.hash)t=r.hash===a.hash;else if(r.attributes.length===a.attributes.length){t=!0;for(var n,s,o=0;t&&r.attributes.length>o;++o)n=r.attributes[o],s=a.attributes[o],(n.type!==s.type||n.value!==s.value)&&(t=!1)}return t},i},r.certificateFromAsn1=function(n,i){var s={},c=[];if(!t.validate(n,o,s,c))throw{message:"Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.",errors:c};var u=t.derToOid(s.publicKeyOid);if(u!==r.oids.rsaEncryption)throw{message:"Cannot read public key. OID is not RSA."};var l=r.createCertificate();l.version=s.certVersion?s.certVersion.charCodeAt(0):0;var f=e.util.createBuffer(s.certSerialNumber);l.serialNumber=f.toHex(),l.signatureOid=e.asn1.derToOid(s.certSignatureOid),l.signatureParameters=C(l.signatureOid,s.certSignatureParams,!0),l.siginfo.algorithmOid=e.asn1.derToOid(s.certinfoSignatureOid),l.siginfo.parameters=C(l.siginfo.algorithmOid,s.certinfoSignatureParams,!1);var d=e.util.createBuffer(s.certSignature);++d.read,l.signature=d.getBytes();var p=[];if(void 0!==s.certValidity1UTCTime&&p.push(t.utcTimeToDate(s.certValidity1UTCTime)),void 0!==s.certValidity2GeneralizedTime&&p.push(t.generalizedTimeToDate(s.certValidity2GeneralizedTime)),void 0!==s.certValidity3UTCTime&&p.push(t.utcTimeToDate(s.certValidity3UTCTime)),void 0!==s.certValidity4GeneralizedTime&&p.push(t.generalizedTimeToDate(s.certValidity4GeneralizedTime)),p.length>2)throw{message:"Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate."};if(2>p.length)throw{message:"Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime."};if(l.validity.notBefore=p[0],l.validity.notAfter=p[1],l.tbsCertificate=s.tbsCertificate,i){if(l.md=null,l.signatureOid in a){var u=a[l.signatureOid];switch(u){case"sha1withRSAEncryption":l.md=e.md.sha1.create();break;case"md5withRSAEncryption":l.md=e.md.md5.create();break;case"sha256WithRSAEncryption":l.md=e.md.sha256.create();break;case"RSASSA-PSS":l.md=e.md.sha256.create()}}if(null===l.md)throw{message:"Could not compute certificate digest. Unknown signature OID.",signatureOid:l.signatureOid};var h=t.toDer(l.tbsCertificate);l.md.update(h.getBytes())}var y=e.md.sha1.create();l.issuer.attributes=r.RDNAttributesAsArray(s.certIssuer,y),s.certIssuerUniqueId&&(l.issuer.uniqueId=s.certIssuerUniqueId),l.issuer.hash=y.digest().toHex();var m=e.md.sha1.create();return l.subject.attributes=r.RDNAttributesAsArray(s.certSubject,m),s.certSubjectUniqueId&&(l.subject.uniqueId=s.certSubjectUniqueId),l.subject.hash=m.digest().toHex(),l.extensions=s.certExtensions?g(s.certExtensions):[],l.publicKey=r.publicKeyFromAsn1(s.subjectPublicKeyInfo),l},_dnToAsn1=function(r){for(var a,n,i=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),s=r.attributes,o=0;s.length>o;++o){a=s[o];var c=a.value,u=t.Type.PRINTABLESTRING;"valueTagClass"in a&&(u=a.valueTagClass,u===t.Type.UTF8&&(c=e.util.encodeUtf8(c))),n=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(a.type).getBytes()),t.create(t.Class.UNIVERSAL,u,!1,c)])]),i.value.push(n)}return i},_extensionsToAsn1=function(e){var r=t.create(t.Class.CONTEXT_SPECIFIC,3,!0,[]),a=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);r.value.push(a);for(var n,i,s=0;e.length>s;++s){n=e[s],i=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),a.value.push(i),i.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.id).getBytes())),n.critical&&i.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255)));var o=n.value;n.value.constructor!=String&&(o=t.toDer(o).getBytes()),i.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,o))}return r};var E=function(e,r){switch(e){case a["RSASSA-PSS"]:var n=[];return void 0!==r.hash.algorithmOid&&n.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])),void 0!==r.mgf.algorithmOid&&n.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.mgf.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.mgf.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])])),void 0!==r.saltLength&&n.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,String.fromCharCode(r.saltLength))])),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,n);default:return t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")}};r.getTBSCertificate=function(a){var n=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,String.fromCharCode(a.version))]),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,e.util.hexToBytes(a.serialNumber)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(a.siginfo.algorithmOid).getBytes()),E(a.siginfo.algorithmOid,a.siginfo.parameters)]),_dnToAsn1(a.issuer),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(a.validity.notBefore)),t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(a.validity.notAfter))]),_dnToAsn1(a.subject),r.publicKeyToAsn1(a.publicKey)]);return a.issuer.uniqueId&&n.value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+a.issuer.uniqueId)])),a.subject.uniqueId&&n.value.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+a.subject.uniqueId)])),a.extensions.length>0&&n.value.push(_extensionsToAsn1(a.extensions)),n},r.distinguishedNameToAsn1=function(e){return _dnToAsn1(e)},r.certificateToAsn1=function(e){var a=e.tbsCertificate||r.getTBSCertificate(e);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[a,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.signatureOid).getBytes()),E(e.signatureOid,e.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},r.createCaStore=function(t){var r={certs:{}};if(r.getIssuer=function(e){var t=null;if(e.issuer.hash in r.certs&&(t=r.certs[e.issuer.hash],t.constructor==Array))throw{message:"Resolving multiple issuer matches not implemented yet."};return t},r.addCertificate=function(t){if(t.constructor==String&&(t=e.pki.certificateFromPem(t)),t.subject.hash in r.certs){var a=r.certs[t.subject.hash];a.constructor!=Array&&(a=[a]),a.push(t)}else r.certs[t.subject.hash]=t},t)for(var a=0;t.length>a;++a){var n=t[a];r.addCertificate(n)}return r},r.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},r.verifyCertificateChain=function(e,t,a){t=t.slice(0);var n=t.slice(0),i=new Date,s=!0,o=null,c=0,u=null;do{var l=t.shift();if(l.validity.notBefore>i||i>l.validity.notAfter)o={message:"Certificate is not valid yet or has expired.",error:r.certificateError.certificate_expired,notBefore:l.validity.notBefore,notAfter:l.validity.notAfter,now:i};else{var f=!1;if(t.length>0){u=t[0];try{f=u.verify(l)}catch(d){}}else{var p=e.getIssuer(l);if(null===p)o={message:"Certificate is not trusted.",error:r.certificateError.unknown_ca};else for(p.constructor!==Array&&(p=[p]);!f&&p.length>0;){u=p.shift();try{f=u.verify(l)}catch(d){}}}null!==o||f||(o={message:"Certificate signature is invalid.",error:r.certificateError.bad_certificate})}if(null!==o||l.isIssuer(u)||(o={message:"Certificate issuer is invalid.",error:r.certificateError.bad_certificate}),null===o)for(var h={keyUsage:!0,basicConstraints:!0},g=0;null===o&&l.extensions.length>g;++g){var y=l.extensions[g];!y.critical||y.name in h||(o={message:"Certificate has an unsupported critical extension.",error:r.certificateError.unsupported_certificate})}if(!s||0===t.length&&!u){var m=l.getExtension("basicConstraints"),v=l.getExtension("keyUsage");null!==v&&(v.keyCertSign&&null!==m||(o={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:r.certificateError.bad_certificate})),null!==o||null===m||m.cA||(o={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:r.certificateError.bad_certificate})}var C=null===o?!0:o.error,E=a?a(C,c,n):C;if(E!==!0)throw C===!0&&(o={message:"The application rejected the certificate.",error:r.certificateError.bad_certificate}),(E||0===E)&&(E.constructor===Object?(E.message&&(o.message=E.message),E.error&&(o.error=E.error)):E.constructor===String&&(o.error=E)),o;o=null,s=!1,++c}while(t.length>0);return!0},r.publicKeyFromAsn1=function(a){var n={},o=[];if(t.validate(a,i,n,o)){var c=t.derToOid(n.publicKeyOid);if(c!==r.oids.rsaEncryption)throw{message:"Cannot read public key. Unknown OID.",oid:c};a=n.rsaPublicKey}if(o=[],!t.validate(n.rsaPublicKey,s,n,o))throw{message:"Cannot read public key. ASN.1 object does not contain an RSAPublicKey.",errors:o};var u=e.util.createBuffer(n.publicKeyModulus).toHex(),l=e.util.createBuffer(n.publicKeyExponent).toHex();return r.setRsaPublicKey(new BigInteger(u,16),new BigInteger(l,16))},r.publicKeyToAsn1=r.publicKeyToSubjectPublicKeyInfo=function(e){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.oids.rsaEncryption).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,[r.publicKeyToRSAPublicKey(e)])])},r.publicKeyToRSAPublicKey=function(e){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.n)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.e))])},r.privateKeyFromAsn1=function(a){var n={},i=[];if(t.validate(a,c,n,i)&&(a=t.fromDer(e.util.createBuffer(n.privateKey))),n={},i=[],!t.validate(a,u,n,i))throw{message:"Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.",errors:i};var s,o,l,f,d,p,h,g;return s=e.util.createBuffer(n.privateKeyModulus).toHex(),o=e.util.createBuffer(n.privateKeyPublicExponent).toHex(),l=e.util.createBuffer(n.privateKeyPrivateExponent).toHex(),f=e.util.createBuffer(n.privateKeyPrime1).toHex(),d=e.util.createBuffer(n.privateKeyPrime2).toHex(),p=e.util.createBuffer(n.privateKeyExponent1).toHex(),h=e.util.createBuffer(n.privateKeyExponent2).toHex(),g=e.util.createBuffer(n.privateKeyCoefficient).toHex(),r.setRsaPrivateKey(new BigInteger(s,16),new BigInteger(o,16),new BigInteger(l,16),new BigInteger(f,16),new BigInteger(d,16),new BigInteger(p,16),new BigInteger(h,16),new BigInteger(g,16))},r.privateKeyToAsn1=r.privateKeyToRSAPrivateKey=function(e){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,String.fromCharCode(0)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.n)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.e)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.d)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.p)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.q)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.dP)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.dQ)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,v(e.qInv))])},r.wrapRsaPrivateKey=function(e){var r=a.rsaEncryption,n=t.oidToDer(r).getBytes(),i=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);return i.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,n)),i.value.push(t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,String.fromCharCode(0)),i,t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(e).getBytes())])},r.encryptPrivateKeyInfo=function(r,n,i){i=i||{},i.saltSize=i.saltSize||8,i.count=i.count||2048,i.algorithm=i.algorithm||"aes128";var s=e.random.getBytes(i.saltSize),o=i.count,c=e.util.createBuffer();c.putInt16(o);var u,l,f;if(0===i.algorithm.indexOf("aes")){var d;if("aes128"===i.algorithm)u=16,d=a["aes128-CBC"];else if("aes192"===i.algorithm)u=24,d=a["aes192-CBC"];else{if("aes256"!==i.algorithm)throw{message:"Cannot encrypt private key. Unknown encryption algorithm.",algorithm:i.algorithm};u=32,d=a["aes256-CBC"]}var p=e.pkcs5.pbkdf2(n,s,o,u),h=e.random.getBytes(16),g=e.aes.createEncryptionCipher(p);g.start(h),g.update(t.toDer(r)),g.finish(),f=g.output.getBytes(),l=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(a.pkcs5PBES2).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(a.pkcs5PBKDF2).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,s),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,c.getBytes())])]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(d).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,h)])])])}else{if("3des"!==i.algorithm)throw{message:"Cannot encrypt private key. Unknown encryption algorithm.",algorithm:i.algorithm};u=24;var y=new e.util.ByteBuffer(s),p=e.pkcs12.generateKey(n,y,1,o,u),h=e.pkcs12.generateKey(n,y,2,o,u),g=e.des.createEncryptionCipher(p);g.start(h),g.update(t.toDer(r)),g.finish(),f=g.output.getBytes(),l=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(a["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,s),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,c.getBytes())])])}var m=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[l,t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f)]);return m},r.pbe.getCipherForPBES2=function(a,n,i){var s={},o=[];if(!t.validate(n,f,s,o))throw{message:"Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.",errors:o};if(a=t.derToOid(s.kdfOid),a!==r.oids.pkcs5PBKDF2)throw{message:"Cannot read encrypted private key. Unsupported key derivation function OID.",oid:a,supportedOids:["pkcs5PBKDF2"]};if(a=t.derToOid(s.encOid),a!==r.oids["aes128-CBC"]&&a!==r.oids["aes192-CBC"]&&a!==r.oids["aes256-CBC"])throw{message:"Cannot read encrypted private key. Unsupported encryption scheme OID.",oid:a,supportedOids:["aes128-CBC","aes192-CBC","aes256-CBC"]};var c=s.kdfSalt,u=e.util.createBuffer(s.kdfIterationCount);u=u.getInt(u.length()<<3);var l;a===r.oids["aes128-CBC"]?l=16:a===r.oids["aes192-CBC"]?l=24:a===r.oids["aes256-CBC"]&&(l=32);var d=e.pkcs5.pbkdf2(i,c,u,l),p=s.encIv,h=e.aes.createDecryptionCipher(d);return h.start(p),h},r.pbe.getCipherForPKCS12PBE=function(a,n,i){var s={},o=[];if(!t.validate(n,d,s,o))throw{message:"Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.",errors:o};var c=e.util.createBuffer(s.salt),u=e.util.createBuffer(s.iterations);u=u.getInt(u.length()<<3);var l,f,p;switch(a){case r.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:l=24,f=8,p=e.des.startDecrypting;break;case r.oids["pbewithSHAAnd40BitRC2-CBC"]:l=5,f=8,p=function(t,r){var a=e.rc2.createDecryptionCipher(t,40);return a.start(r,null),a};break;default:throw{message:"Cannot read PKCS #12 PBE data block. Unsupported OID.",oid:a}}var h=e.pkcs12.generateKey(i,c,1,u,l),g=e.pkcs12.generateKey(i,c,2,u,f);return p(h,g)},r.pbe.getCipher=function(e,t,a){switch(e){case r.oids.pkcs5PBES2:return r.pbe.getCipherForPBES2(e,t,a);case r.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case r.oids["pbewithSHAAnd40BitRC2-CBC"]:return r.pbe.getCipherForPKCS12PBE(e,t,a);default:throw{message:"Cannot read encrypted PBE data block. Unsupported OID.",oid:e,supportedOids:["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"]}}},r.decryptPrivateKeyInfo=function(a,n){var i=null,s={},o=[];if(!t.validate(a,l,s,o))throw{message:"Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.",errors:o};var c=t.derToOid(s.encryptionOid),u=r.pbe.getCipher(c,s.encryptionParams,n),f=e.util.createBuffer(s.encryptedData);return u.update(f),u.finish()&&(i=t.fromDer(u.output)),i},r.encryptedPrivateKeyToPem=function(r,a){var n=t.toDer(r);return n=e.util.encode64(n.getBytes(),a||64),"-----BEGIN ENCRYPTED PRIVATE KEY-----\r\n"+n+"\r\n-----END ENCRYPTED PRIVATE KEY-----"},r.encryptedPrivateKeyFromPem=function(e){var a=r.pemToDer(e);return t.fromDer(a)},r.encryptRsaPrivateKey=function(e,t,a){var n=r.wrapRsaPrivateKey(r.privateKeyToAsn1(e));return n=r.encryptPrivateKeyInfo(n,t,a),r.encryptedPrivateKeyToPem(n)},r.decryptRsaPrivateKey=function(e,t){var a=r.encryptedPrivateKeyFromPem(e);return a=r.decryptPrivateKeyInfo(a,t),null!==a&&(a=r.privateKeyFromAsn1(a)),a},r.setRsaPublicKey=r.rsa.setPublicKey,r.setRsaPrivateKey=r.rsa.setPrivateKey}var t="pki",r=["./aes","./asn1","./des","./jsbn","./md","./mgf","./oids","./pbkdf2","./pkcs12","./pss","./random","./rc2","./rsa","./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t="object"==typeof module&&module.exports,r=null;t&&(r=require("crypto"));var a=e.prng=e.prng||{};a.create=function(t){function a(e){if(o.pools[0].messageLength>=32)return i(),e();var t=32-o.pools[0].messageLength<<5;o.seedFile(t,function(t,r){return t?e(t):(o.collect(r),i(),e(),void 0)})}function n(){if(o.pools[0].messageLength>=32)return i();var e=32-o.pools[0].messageLength<<5;o.collect(o.seedFileSync(e)),i()}function i(){var t=e.md.sha1.create();t.update(o.pools[0].digest().getBytes()),o.pools[0].start();for(var r=1,a=1;32>a;++a)r=31===r?2147483648:r<<2,0===r%o.reseeds&&(t.update(o.pools[a].digest().getBytes()),o.pools[a].start());var n=t.digest().getBytes();t.start(),t.update(n);var i=t.digest().getBytes();o.key=o.plugin.formatKey(n),o.seed=o.plugin.formatSeed(i),++o.reseeds,o.generated=0,o.time=+new Date}function s(t){var r=e.util.createBuffer();if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues){var a=new Uint32Array(t/4);try{window.crypto.getRandomValues(a);for(var n=0;a.length>n;++n)r.putInt32(a[n])}catch(i){}}if(t>r.length())for(var s,o,c,u=Math.floor(65535*Math.random());t>r.length();){o=16807*(65535&u),s=16807*(u>>16),o+=(32767&s)<<16,o+=s>>15,o=(2147483647&o)+(o>>31),u=4294967295&o;for(var n=0;3>n;++n)c=u>>>(n<<3),c^=Math.floor(255*Math.random()),r.putByte(String.fromCharCode(255&c))}return r.getBytes()}for(var o={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0},c=t.md,u=Array(32),l=0;32>l;++l)u[l]=c.create();return o.pools=u,o.pool=0,o.generate=function(t,r){function n(f){if(f)return r(f);if(l.length()>=t)return r(null,l.getBytes(t));if(o.generated>=1048576){var d=+new Date;(null===o.time||d-o.time>100)&&(o.key=null)}if(null===o.key)return a(n);var p=i(o.key,o.seed);o.generated+=p.length,l.putBytes(p),o.key=c(i(o.key,s(o.seed))),o.seed=u(i(o.key,o.seed)),e.util.setImmediate(n)}if(!r)return o.generateSync(t);var i=o.plugin.cipher,s=o.plugin.increment,c=o.plugin.formatKey,u=o.plugin.formatSeed,l=e.util.createBuffer();n()},o.generateSync=function(t){for(var r=o.plugin.cipher,a=o.plugin.increment,i=o.plugin.formatKey,s=o.plugin.formatSeed,c=e.util.createBuffer();t>c.length();){if(o.generated>=1048576){var u=+new Date;(null===o.time||u-o.time>100)&&(o.key=null)}null===o.key&&n();var l=r(o.key,o.seed);o.generated+=l.length,c.putBytes(l),o.key=i(r(o.key,a(o.seed))),o.seed=s(r(o.key,o.seed))}return c.getBytes(t)},r?(o.seedFile=function(e,t){r.randomBytes(e,function(e,r){return e?t(e):(t(null,""+r),void 0)})},o.seedFileSync=function(e){return""+r.randomBytes(e)}):(o.seedFile=function(e,t){try{t(null,s(e))}catch(r){t(r)}},o.seedFileSync=s),o.collect=function(e){for(var t=e.length,r=0;t>r;++r)o.pools[o.pool].update(e.substr(r,1)),o.pool=31===o.pool?0:o.pool+1},o.collectInt=function(e,t){for(var r="",a=0;t>a;a+=8)r+=String.fromCharCode(255&e>>a);o.collect(r)},o.registerWorker=function(e){function t(t){var r=t.data;r.forge&&r.forge.prng&&o.seedFile(r.forge.prng.needed,function(t,r){e.postMessage({forge:{prng:{err:t,bytes:r}}})})}e===self?o.seedFile=function(e,t){function r(e){var a=e.data;a.forge&&a.forge.prng&&(self.removeEventListener("message",r),t(a.forge.prng.err,a.forge.prng.bytes))}self.addEventListener("message",r),self.postMessage({forge:{prng:{needed:e}}})}:e.addEventListener("message",t)},o}}var t="prng",r=["./md","./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=e.pss=e.pss||{};t.create=function(t,r,a){var n=t.digestLength,i={};return i.verify=function(i,s,o){var c,u=o-1,l=Math.ceil(u/8);if(s=s.substr(-l),n+a+2>l)throw{message:"Inconsistent parameters to PSS signature verification."};if(188!==s.charCodeAt(l-1))throw{message:"Encoded message does not end in 0xBC."};var f=l-n-1,d=s.substr(0,f),p=s.substr(f,n),h=255&65280>>8*l-u;if(0!==(d.charCodeAt(0)&h))throw{message:"Bits beyond keysize not zero as expected."};var g=r.generate(p,f),y="";for(c=0;f>c;c++)y+=String.fromCharCode(d.charCodeAt(c)^g.charCodeAt(c));y=String.fromCharCode(y.charCodeAt(0)&~h)+y.substr(1);var m=l-n-a-2;for(c=0;m>c;c++)if(0!==y.charCodeAt(c))throw{message:"Leftmost octets not zero as expected"};if(1!==y.charCodeAt(m))throw{message:"Inconsistent PSS signature, 0x01 marker not found"};var v=y.substr(-a),C=new e.util.ByteBuffer;C.fillWithByte(0,8),C.putBytes(i),C.putBytes(v),t.start(),t.update(C.getBytes());var E=t.digest().getBytes();return p===E},i.encode=function(i,s){var o,c=s-1,u=Math.ceil(c/8),l=i.digest().getBytes();if(n+a+2>u)throw{message:"Message is too long to encrypt"};var f=e.random.getBytes(a),d=new e.util.ByteBuffer;d.fillWithByte(0,8),d.putBytes(l),d.putBytes(f),t.start(),t.update(d.getBytes());var p=t.digest().getBytes(),h=new e.util.ByteBuffer;h.fillWithByte(0,u-a-n-2),h.putByte(1),h.putBytes(f);var g=h.getBytes(),y=u-n-1,m=r.generate(p,y),v="";for(o=0;y>o;o++)v+=String.fromCharCode(g.charCodeAt(o)^m.charCodeAt(o));var C=255&65280>>8*u-c;return v=String.fromCharCode(v.charCodeAt(0)&~C)+v.substr(1),v+p+String.fromCharCode(188)},i}}var t="pss",r=["./random","./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=e.util=e.util||{};"undefined"!=typeof process&&process.nextTick?(t.nextTick=process.nextTick,t.setImmediate="function"==typeof setImmediate?setImmediate:t.nextTick):"function"==typeof setImmediate?(t.setImmediate=setImmediate,t.nextTick=function(e){return setImmediate(e)}):(t.setImmediate=function(e){setTimeout(e,0)},t.nextTick=t.setImmediate),t.isArray=Array.isArray?Array.isArray:function(e){return e&&e.constructor===Array},t.ByteBuffer=function(e){this.data=e||"",this.read=0},t.ByteBuffer.prototype.length=function(){return this.data.length-this.read
},t.ByteBuffer.prototype.isEmpty=function(){return 0===this.data.length-this.read},t.ByteBuffer.prototype.putByte=function(e){this.data+=String.fromCharCode(e)},t.ByteBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;t>0;)1&t&&(r+=e),t>>>=1,t>0&&(e+=e);this.data=r},t.ByteBuffer.prototype.putBytes=function(e){this.data+=e},t.ByteBuffer.prototype.putString=function(e){this.data+=t.encodeUtf8(e)},t.ByteBuffer.prototype.putInt16=function(e){this.data+=String.fromCharCode(255&e>>8)+String.fromCharCode(255&e)},t.ByteBuffer.prototype.putInt24=function(e){this.data+=String.fromCharCode(255&e>>16)+String.fromCharCode(255&e>>8)+String.fromCharCode(255&e)},t.ByteBuffer.prototype.putInt32=function(e){this.data+=String.fromCharCode(255&e>>24)+String.fromCharCode(255&e>>16)+String.fromCharCode(255&e>>8)+String.fromCharCode(255&e)},t.ByteBuffer.prototype.putInt16Le=function(e){this.data+=String.fromCharCode(255&e)+String.fromCharCode(255&e>>8)},t.ByteBuffer.prototype.putInt24Le=function(e){this.data+=String.fromCharCode(255&e)+String.fromCharCode(255&e>>8)+String.fromCharCode(255&e>>16)},t.ByteBuffer.prototype.putInt32Le=function(e){this.data+=String.fromCharCode(255&e)+String.fromCharCode(255&e>>8)+String.fromCharCode(255&e>>16)+String.fromCharCode(255&e>>24)},t.ByteBuffer.prototype.putInt=function(e,t){do t-=8,this.data+=String.fromCharCode(255&e>>t);while(t>0)},t.ByteBuffer.prototype.putBuffer=function(e){this.data+=e.getBytes()},t.ByteBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},t.ByteBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},t.ByteBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},t.ByteBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},t.ByteBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},t.ByteBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},t.ByteBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},t.ByteBuffer.prototype.getInt=function(e){var t=0;do t=(t<<e)+this.data.charCodeAt(this.read++),e-=8;while(e>0);return t},t.ByteBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},t.ByteBuffer.prototype.bytes=function(e){return e===void 0?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},t.ByteBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},t.ByteBuffer.prototype.setAt=function(e,t){this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1)},t.ByteBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},t.ByteBuffer.prototype.copy=function(){var e=t.createBuffer(this.data);return e.read=this.read,e},t.ByteBuffer.prototype.compact=function(){this.read>0&&(this.data=this.data.slice(this.read),this.read=0)},t.ByteBuffer.prototype.clear=function(){this.data="",this.read=0},t.ByteBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);this.data=this.data.substr(this.read,t),this.read=0},t.ByteBuffer.prototype.toHex=function(){for(var e="",t=this.read;this.data.length>t;++t){var r=this.data.charCodeAt(t);16>r&&(e+="0"),e+=r.toString(16)}return e},t.ByteBuffer.prototype.toString=function(){return t.decodeUtf8(this.bytes())},t.createBuffer=function(e,r){return r=r||"raw",void 0!==e&&"utf8"===r&&(e=t.encodeUtf8(e)),new t.ByteBuffer(e)},t.fillString=function(e,t){for(var r="";t>0;)1&t&&(r+=e),t>>>=1,t>0&&(e+=e);return r},t.xorBytes=function(e,t,r){for(var a="",n="",i="",s=0,o=0;r>0;--r,++s)n=e.charCodeAt(s)^t.charCodeAt(s),o>=10&&(a+=i,i="",o=0),i+=String.fromCharCode(n),++o;return a+=i},t.hexToBytes=function(e){var t="",r=0;for(true&e.length&&(r=1,t+=String.fromCharCode(parseInt(e[0],16)));e.length>r;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},t.bytesToHex=function(e){return t.createBuffer(e).toHex()},t.int32ToBytes=function(e){return String.fromCharCode(255&e>>24)+String.fromCharCode(255&e>>16)+String.fromCharCode(255&e>>8)+String.fromCharCode(255&e)};var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];t.encode64=function(e,t){for(var a,n,i,s="",o="",c=0;e.length>c;)a=e.charCodeAt(c++),n=e.charCodeAt(c++),i=e.charCodeAt(c++),s+=r.charAt(a>>2),s+=r.charAt((3&a)<<4|n>>4),isNaN(n)?s+="==":(s+=r.charAt((15&n)<<2|i>>6),s+=isNaN(i)?"=":r.charAt(63&i)),t&&s.length>t&&(o+=s.substr(0,t)+"\r\n",s=s.substr(t));return o+=s},t.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,r,n,i,s="",o=0;e.length>o;)t=a[e.charCodeAt(o++)-43],r=a[e.charCodeAt(o++)-43],n=a[e.charCodeAt(o++)-43],i=a[e.charCodeAt(o++)-43],s+=String.fromCharCode(t<<2|r>>4),64!==n&&(s+=String.fromCharCode((15&r)<<4|n>>2),64!==i&&(s+=String.fromCharCode((3&n)<<6|i)));return s},t.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},t.decodeUtf8=function(e){return decodeURIComponent(escape(e))},t.deflate=function(e,r,a){if(r=t.decode64(e.deflate(t.encode64(r)).rval),a){var n=2,i=r.charCodeAt(1);32&i&&(n=6),r=r.substring(n,r.length-4)}return r},t.inflate=function(e,r){var a=e.inflate(t.encode64(r)).rval;return null===a?null:t.decode64(a)};var n=function(e,r,a){if(!e)throw{message:"WebStorage not available."};var n;if(null===a?n=e.removeItem(r):(a=t.encode64(JSON.stringify(a)),n=e.setItem(r,a)),n!==void 0&&n.rval!==!0)throw n.error},i=function(e,r){if(!e)throw{message:"WebStorage not available."};var a=e.getItem(r);if(e.init)if(null===a.rval){if(a.error)throw a.error;a=null}else a=a.rval;return null!==a&&(a=JSON.parse(t.decode64(a))),a},s=function(e,t,r,a){var s=i(e,t);null===s&&(s={}),s[r]=a,n(e,t,s)},o=function(e,t,r){var a=i(e,t);return null!==a&&(a=r in a?a[r]:null),a},c=function(e,t,r){var a=i(e,t);if(null!==a&&r in a){delete a[r];var s=!0;for(var o in a){s=!1;break}s&&(a=null),n(e,t,a)}},u=function(e,t){n(e,t,null)},l=function(e,t,r){var a=null;r===void 0&&(r=["web","flash"]);var n,i=!1,s=null;for(var o in r){n=r[o];try{if("flash"===n||"both"===n){if(null===t[0])throw{message:"Flash local storage not available."};a=e.apply(this,t),i="flash"===n}("web"===n||"both"===n)&&(t[0]=localStorage,a=e.apply(this,t),i=!0)}catch(c){s=c}if(i)break}if(!i)throw s;return a};t.setItem=function(e,t,r,a,n){l(s,arguments,n)},t.getItem=function(e,t,r,a){return l(o,arguments,a)},t.removeItem=function(e,t,r,a){l(c,arguments,a)},t.clearItems=function(e,t,r){l(u,arguments,r)},t.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var r=t.exec(e),a=null===r?null:{full:e,scheme:r[1],host:r[2],port:r[3],path:r[4]};return a&&(a.fullHost=a.host,a.port?80!==a.port&&"http"===a.scheme?a.fullHost+=":"+a.port:443!==a.port&&"https"===a.scheme&&(a.fullHost+=":"+a.port):"http"===a.scheme?a.port=80:"https"===a.scheme&&(a.port=443),a.full=a.scheme+"://"+a.fullHost),a};var f=null;t.getQueryVariables=function(e){var t,r=function(e){for(var t={},r=e.split("&"),a=0;r.length>a;a++){var n,i,s=r[a].indexOf("=");s>0?(n=r[a].substring(0,s),i=r[a].substring(s+1)):(n=r[a],i=null),n in t||(t[n]=[]),null!==i&&t[n].push(unescape(i))}return t};return e===void 0?(null===f&&(f="undefined"==typeof window?{}:r(window.location.search.substring(1))),t=f):t=r(e),t},t.parseFragment=function(e){var r=e,a="",n=e.indexOf("?");n>0&&(r=e.substring(0,n),a=e.substring(n+1));var i=r.split("/");i.length>0&&""===i[0]&&i.shift();var s=""===a?{}:t.getQueryVariables(a);return{pathString:r,queryString:a,path:i,query:s}},t.makeRequest=function(e){var r=t.parseFragment(e),a={path:r.pathString,query:r.queryString,getPath:function(e){return e===void 0?r.path:r.path[e]},getQuery:function(e,t){var a;return e===void 0?a=r.query:(a=r.query[e],a&&t!==void 0&&(a=a[t])),a},getQueryLast:function(e,t){var r,n=a.getQuery(e);return r=n?n[n.length-1]:t}};return a},t.makeLink=function(e,t,r){e=jQuery.isArray(e)?e.join("/"):e;var a=jQuery.param(t||{});return r=r||"",e+(a.length>0?"?"+a:"")+(r.length>0?"#"+r:"")},t.setPath=function(e,t,r){if("object"==typeof e&&null!==e)for(var a=0,n=t.length;n>a;){var i=t[a++];if(a==n)e[i]=r;else{var s=i in e;(!s||s&&"object"!=typeof e[i]||s&&null===e[i])&&(e[i]={}),e=e[i]}}},t.getPath=function(e,t,r){for(var a=0,n=t.length,i=!0;i&&n>a&&"object"==typeof e&&null!==e;){var s=t[a++];i=s in e,i&&(e=e[s])}return i?e:r},t.deletePath=function(e,t){if("object"==typeof e&&null!==e)for(var r=0,a=t.length;a>r;){var n=t[r++];if(r==a)delete e[n];else{if(!(n in e)||"object"!=typeof e[n]||null===e[n])break;e=e[n]}}},t.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.format=function(e){for(var t,r,a=/%./g,n=0,i=[],s=0;t=a.exec(e);){r=e.substring(s,a.lastIndex-2),r.length>0&&i.push(r),s=a.lastIndex;var o=t[0][1];switch(o){case"s":case"o":arguments.length>n?i.push(arguments[n++ +1]):i.push("<?>");break;case"%":i.push("%");break;default:i.push("<%"+o+"?>")}}return i.push(e.substring(s)),i.join("")},t.formatNumber=function(e,t,r,a){var n=e,i=isNaN(t=Math.abs(t))?2:t,s=void 0===r?",":r,o=void 0===a?".":a,c=0>n?"-":"",u=parseInt(n=Math.abs(+n||0).toFixed(i),10)+"",l=u.length>3?u.length%3:0;return c+(l?u.substr(0,l)+o:"")+u.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+o)+(i?s+Math.abs(n-u).toFixed(i).slice(2):"")},t.formatSize=function(e){return e=e>=1073741824?t.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?t.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?t.formatNumber(e/1024,0)+" KiB":t.formatNumber(e,0)+" bytes"}}var t="util",r=[],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){e.random&&e.random.getBytes||function(t){var r={},a=Array(4),n=e.util.createBuffer();r.formatKey=function(t){var r=e.util.createBuffer(t);return t=Array(4),t[0]=r.getInt32(),t[1]=r.getInt32(),t[2]=r.getInt32(),t[3]=r.getInt32(),e.aes._expandKey(t,!1)},r.formatSeed=function(t){var r=e.util.createBuffer(t);return t=Array(4),t[0]=r.getInt32(),t[1]=r.getInt32(),t[2]=r.getInt32(),t[3]=r.getInt32(),t},r.cipher=function(t,r){return e.aes._updateBlock(t,r,a,!1),n.putInt32(a[0]),n.putInt32(a[1]),n.putInt32(a[2]),n.putInt32(a[3]),n.getBytes()},r.increment=function(e){return++e[3],e},r.md=e.md.sha1;var i=e.prng.create(r),s="object"==typeof module&&module.exports;if(!(s||"undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues)){if("undefined"==typeof window||void 0===window.document,i.collectInt(+new Date,32),"undefined"!=typeof navigator){var o="";for(var c in navigator)try{"string"==typeof navigator[c]&&(o+=navigator[c])}catch(u){}i.collect(o),o=null}t&&(t().mousemove(function(e){i.collectInt(e.clientX,16),i.collectInt(e.clientY,16)}),t().keypress(function(e){i.collectInt(e.charCode,8)}))}if(e.random)for(var c in i)e.random[c]=i[c];else e.random=i;e.random.getBytes=function(t,r){return e.random.generate(t,r)},e.random.getBytesSync=function(t){return e.random.generate(t)}}("undefined"!=typeof jQuery?jQuery:null)}var t="random",r=["./aes","./md","./prng","./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],r=[1,2,3,5],a=function(e,t){return 65535&e<<t|(65535&e)>>16-t},n=function(e,t){return(65535&e)>>t|65535&e<<16-t};e.rc2=e.rc2||{},e.rc2.expandKey=function(r,a){r.constructor==String&&(r=e.util.createBuffer(r)),a=a||128;var n,i=r,s=r.length(),o=a,c=Math.ceil(o/8),u=255>>(7&o);for(n=s;128>n;n++)i.putByte(t[255&i.at(n-1)+i.at(n-s)]);for(i.setAt(128-c,t[i.at(128-c)&u]),n=127-c;n>=0;n--)i.setAt(n,t[i.at(n+1)^i.at(n+c)]);return i};var i=function(t,i,s){var o,c,u,l,f=!1,d=null,p=null,h=null,g=[];for(t=e.rc2.expandKey(t,i),u=0;64>u;u++)g.push(t.getInt16Le());s?(o=function(e){for(u=0;4>u;u++)e[u]+=g[l]+(e[(u+3)%4]&e[(u+2)%4])+(~e[(u+3)%4]&e[(u+1)%4]),e[u]=a(e[u],r[u]),l++},c=function(e){for(u=0;4>u;u++)e[u]+=g[63&e[(u+3)%4]]}):(o=function(e){for(u=3;u>=0;u--)e[u]=n(e[u],r[u]),e[u]-=g[l]+(e[(u+3)%4]&e[(u+2)%4])+(~e[(u+3)%4]&e[(u+1)%4]),l--},c=function(e){for(u=3;u>=0;u--)e[u]-=g[63&e[(u+3)%4]]});var y=function(e){var t=[];for(u=0;4>u;u++){var r=d.getInt16Le();null!==h&&(s?r^=h.getInt16Le():h.putInt16Le(r)),t.push(65535&r)}l=s?0:63;for(var a=0;e.length>a;a++)for(var n=0;e[a][0]>n;n++)e[a][1](t);for(u=0;4>u;u++)null!==h&&(s?h.putInt16Le(t[u]):t[u]^=h.getInt16Le()),p.putInt16Le(t[u])},m=null;return m={start:function(r,a){r&&t.constructor==String&&8==r.length&&(r=e.util.createBuffer(r)),f=!1,d=e.util.createBuffer(),p=a||new e.util.createBuffer,h=r,m.output=p},update:function(e){for(f||d.putBuffer(e);d.length()>=8;)y([[5,o],[1,c],[6,o],[1,c],[5,o]])},finish:function(e){var t=!0;if(s)if(e)t=e(8,d,!s);else{var r=8==d.length()?8:8-d.length();d.fillWithByte(r,r)}if(t&&(f=!0,m.update()),!s&&(t=0===d.length()))if(e)t=e(8,p,!s);else{var a=p.length(),n=p.at(a-1);n>a?t=!1:p.truncate(n)}return t}}};e.rc2.startEncrypting=function(t,r,a){var n=e.rc2.createEncryptionCipher(t,128);return n.start(r,a),n},e.rc2.createEncryptionCipher=function(e,t){return i(e,t,!0)},e.rc2.startDecrypting=function(t,r,a){var n=e.rc2.createDecryptionCipher(t,128);return n.start(r,a),n},e.rc2.createDecryptionCipher=function(e,t){return i(e,t,!1)}}var t="rc2",r=["./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t="forge.task",r=0,a={},n=0;e.debug.set(t,"tasks",a);var i={};e.debug.set(t,"queues",i);var s="?",o=30,c=20,u="ready",l="running",f="blocked",d="sleeping",p="done",h="error",g="stop",y="start",m="block",v="unblock",C="sleep",E="wakeup",S="cancel",T="fail",I={};I[u]={},I[u][g]=u,I[u][y]=l,I[u][S]=p,I[u][T]=h,I[l]={},I[l][g]=u,I[l][y]=l,I[l][m]=f,I[l][v]=l,I[l][C]=d,I[l][E]=l,I[l][S]=p,I[l][T]=h,I[f]={},I[f][g]=f,I[f][y]=f,I[f][m]=f,I[f][v]=f,I[f][C]=f,I[f][E]=f,I[f][S]=p,I[f][T]=h,I[d]={},I[d][g]=d,I[d][y]=d,I[d][m]=d,I[d][v]=d,I[d][C]=d,I[d][E]=d,I[d][S]=p,I[d][T]=h,I[p]={},I[p][g]=p,I[p][y]=p,I[p][m]=p,I[p][v]=p,I[p][C]=p,I[p][E]=p,I[p][S]=p,I[p][T]=h,I[h]={},I[h][g]=h,I[h][y]=h,I[h][m]=h,I[h][v]=h,I[h][C]=h,I[h][E]=h,I[h][S]=h,I[h][T]=h;var B=function(i){this.id=-1,this.name=i.name||s,this.parent=i.parent||null,this.run=i.run,this.subtasks=[],this.error=!1,this.state=u,this.blocks=0,this.timeoutId=null,this.swapTime=null,this.userData=null,this.id=n++,a[this.id]=this,r>=1&&e.log.verbose(t,"[%s][%s] init",this.id,this.name,this)};B.prototype.debug=function(r){r=r||"",e.log.debug(t,r,"[%s][%s] task:",this.id,this.name,this,"subtasks:",this.subtasks.length,"queue:",i)},B.prototype.next=function(e,t){"function"==typeof e&&(t=e,e=this.name);var r=new B({run:t,name:e,parent:this});return r.state=l,r.type=this.type,r.successCallback=this.successCallback||null,r.failureCallback=this.failureCallback||null,this.subtasks.push(r),this},B.prototype.parallel=function(t,r){return t.constructor==Array&&(r=t,t=this.name),this.next(t,function(a){var n=a;n.block(r.length);for(var i=function(t,a){e.task.start({type:t,run:function(e){r[a](e)},success:function(){n.unblock()},failure:function(){n.unblock()}})},s=0;r.length>s;s++){var o=t+"__parallel-"+a.id+"-"+s,c=s;i(o,c)}})},B.prototype.stop=function(){this.state=I[this.state][g]},B.prototype.start=function(){this.error=!1,this.state=I[this.state][y],this.state===l&&(this.start=new Date,this.run(this),b(this,0))},B.prototype.block=function(e){e=e===void 0?1:e,this.blocks+=e,this.blocks>0&&(this.state=I[this.state][m])},B.prototype.unblock=function(e){return e=e===void 0?1:e,this.blocks-=e,0===this.blocks&&this.state!==p&&(this.state=l,b(this,0)),this.blocks},B.prototype.sleep=function(e){e=e===void 0?0:e,this.state=I[this.state][C];var t=this;this.timeoutId=setTimeout(function(){t.timeoutId=null,t.state=l,b(t,0)},e)},B.prototype.wait=function(e){e.wait(this)},B.prototype.wakeup=function(){this.state===d&&(cancelTimeout(this.timeoutId),this.timeoutId=null,this.state=l,b(this,0))},B.prototype.cancel=function(){this.state=I[this.state][S],this.permitsNeeded=0,null!==this.timeoutId&&(cancelTimeout(this.timeoutId),this.timeoutId=null),this.subtasks=[]},B.prototype.fail=function(e){if(this.error=!0,N(this,!0),e)e.error=this.error,e.swapTime=this.swapTime,e.userData=this.userData,b(e,0);else{if(null!==this.parent){for(var t=this.parent;null!==t.parent;)t.error=this.error,t.swapTime=this.swapTime,t.userData=this.userData,t=t.parent;N(t,!0)}this.failureCallback&&this.failureCallback(this)}};var A=function(e){e.error=!1,e.state=I[e.state][y],setTimeout(function(){e.state===l&&(e.swapTime=+new Date,e.run(e),b(e,0))},0)},b=function(e,t){var r=t>o||+new Date-e.swapTime>c,a=function(t){if(t++,e.state===l)if(r&&(e.swapTime=+new Date),e.subtasks.length>0){var a=e.subtasks.shift();a.error=e.error,a.swapTime=e.swapTime,a.userData=e.userData,a.run(a),a.error||b(a,t)}else N(e),e.error||null!==e.parent&&(e.parent.error=e.error,e.parent.swapTime=e.swapTime,e.parent.userData=e.userData,b(e.parent,t))};r?setTimeout(a,0):a(t)},N=function(n,s){n.state=p,delete a[n.id],r>=1&&e.log.verbose(t,"[%s][%s] finish",n.id,n.name,n),null===n.parent&&(n.type in i?0===i[n.type].length?e.log.error(t,"[%s][%s] task queue empty [%s]",n.id,n.name,n.type):i[n.type][0]!==n?e.log.error(t,"[%s][%s] task not first in queue [%s]",n.id,n.name,n.type):(i[n.type].shift(),0===i[n.type].length?(r>=1&&e.log.verbose(t,"[%s][%s] delete queue [%s]",n.id,n.name,n.type),delete i[n.type]):(r>=1&&e.log.verbose(t,"[%s][%s] queue start next [%s] remain:%s",n.id,n.name,n.type,i[n.type].length),i[n.type][0].start())):e.log.error(t,"[%s][%s] task queue missing [%s]",n.id,n.name,n.type),s||(n.error&&n.failureCallback?n.failureCallback(n):!n.error&&n.successCallback&&n.successCallback(n)))};e.task=e.task||{},e.task.start=function(a){var n=new B({run:a.run,name:a.name||s});n.type=a.type,n.successCallback=a.success||null,n.failureCallback=a.failure||null,n.type in i?i[a.type].push(n):(r>=1&&e.log.verbose(t,"[%s][%s] create queue [%s]",n.id,n.name,n.type),i[n.type]=[n],A(n))},e.task.cancel=function(e){e in i&&(i[e]=[i[e][0]])},e.task.createCondition=function(){var e={tasks:{}};return e.wait=function(t){t.id in e.tasks||(t.block(),e.tasks[t.id]=t)},e.notify=function(){var t=e.tasks;e.tasks={};for(var r in t)t[r].unblock()},e}}var t="task",r=["./debug","./log","./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){var t=function(t,r,a,n){var i=e.util.createBuffer(),s=t.length>>1,o=s+(1&t.length),c=t.substr(0,o),u=t.substr(s,o),l=e.util.createBuffer(),f=e.hmac.create();a=r+a;var d=Math.ceil(n/16),p=Math.ceil(n/20);f.start("MD5",c);var h=e.util.createBuffer();l.putBytes(a);for(var g=0;d>g;++g)f.start(null,null),f.update(l.getBytes()),l.putBuffer(f.digest()),f.start(null,null),f.update(l.bytes()+a),h.putBuffer(f.digest());f.start("SHA1",u);var y=e.util.createBuffer();l.clear(),l.putBytes(a);for(var g=0;p>g;++g)f.start(null,null),f.update(l.getBytes()),l.putBuffer(f.digest()),f.start(null,null),f.update(l.bytes()+a),y.putBuffer(f.digest());return i.putBytes(e.util.xorBytes(h.getBytes(),y.getBytes(),n)),i},r=function(t,r,a){var n=e.hmac.create();n.start("SHA1",t);var i=e.util.createBuffer();return i.putInt32(r[0]),i.putInt32(r[1]),i.putByte(a.type),i.putByte(a.version.major),i.putByte(a.version.minor),i.putInt16(a.length),i.putBytes(a.fragment.bytes()),n.update(i.getBytes()),n.digest().getBytes()},a=function(t,r){var a=!1;try{var n=t.deflate(r.fragment.getBytes());r.fragment=e.util.createBuffer(n),r.length=n.length,a=!0}catch(i){}return a},n=function(t,r){var a=!1;try{var n=t.inflate(r.fragment.getBytes());r.fragment=e.util.createBuffer(n),r.length=n.length,a=!0}catch(i){}return a},i=function(t,r){var a=0;switch(r){case 1:a=t.getByte();break;case 2:a=t.getInt16();break;case 3:a=t.getInt24();break;case 4:a=t.getInt32()}return e.util.createBuffer(t.getBytes(a))},s=function(e,t,r){e.putInt(r.length(),t<<3),e.putBuffer(r)},o={};o.Version={major:3,minor:1},o.MaxFragment=15360,o.ConnectionEnd={server:0,client:1},o.PRFAlgorithm={tls_prf_sha256:0},o.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2},o.CipherType={stream:0,block:1,aead:2},o.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4},o.CompressionMethod={none:0,deflate:1},o.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23},o.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20},o.Alert={},o.Alert.Level={warning:1,fatal:2},o.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100},o.CipherSuites={},o.getCipherSuite=function(e){var t=null;for(var r in o.CipherSuites){var a=o.CipherSuites[r];if(a.id[0]===e.charCodeAt(0)&&a.id[1]===e.charCodeAt(1)){t=a;break}}return t},o.handleUnexpected=function(e){var t=!e.open&&e.entity===o.ConnectionEnd.client;t||e.error(e,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.unexpected_message}})},o.handleHelloRequest=function(e){!e.handshaking&&e.handshakes>0&&(o.queue(e,o.createAlert({level:o.Alert.Level.warning,description:o.Alert.Description.no_renegotiation})),o.flush(e)),e.process()},o.parseHelloMessage=function(t,r,a){var n=null,s=t.entity==o.ConnectionEnd.client;if(38>a)t.error(t,{message:s?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.illegal_parameter}});else{var c=r.fragment,u=c.length();if(n={version:{major:c.getByte(),minor:c.getByte()},random:e.util.createBuffer(c.getBytes(32)),session_id:i(c,1),extensions:[]},s?(n.cipher_suite=c.getBytes(2),n.compression_method=c.getByte()):(n.cipher_suites=i(c,2),n.compression_methods=i(c,1)),u=a-(u-c.length()),u>0){for(var l=i(c,2);l.length()>0;)n.extensions.push({type:[l.getByte(),l.getByte()],data:i(l,2)});if(!s)for(var f=0;n.extensions.length>f;++f){var d=n.extensions[f];if(0===d.type[0]&&0===d.type[1])for(var p=i(d.data,2);p.length()>0;){var h=p.getByte();if(0!==h)break;t.session.serverNameList.push(i(p,2).getBytes())}}}if((n.version.major!==o.Version.major||n.version.minor!==o.Version.minor)&&t.error(t,{message:"Incompatible TLS version.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.protocol_version}}),s)t.session.cipherSuite=o.getCipherSuite(n.cipher_suite);else for(var g=e.util.createBuffer(n.cipher_suites.bytes());g.length()>0&&(t.session.cipherSuite=o.getCipherSuite(g.getBytes(2)),null===t.session.cipherSuite););null===t.session.cipherSuite&&t.error(t,{message:"No cipher suites in common.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.handshake_failure},cipherSuite:e.util.bytesToHex(n.cipher_suite)}),t.session.compressionMethod=s?n.compression_method:o.CompressionMethod.none}return n},o.createSecurityParameters=function(e,t){var r=e.entity===o.ConnectionEnd.client,a=t.random.bytes(),n=r?e.session.sp.client_random:a,i=r?a:o.createRandom().getBytes();e.session.sp={entity:e.entity,prf_algorithm:o.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:e.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:n,server_random:i}},o.handleServerHello=function(e,t,r){var a=o.parseHelloMessage(e,t,r);if(!e.fail){var n=a.session_id.bytes();n===e.session.id?(e.expect=p,e.session.resuming=!0,e.session.sp.server_random=a.random.bytes()):(e.expect=u,e.session.resuming=!1,o.createSecurityParameters(e,a)),e.session.id=n,e.process()}},o.handleClientHello=function(t,r,a){var n=o.parseHelloMessage(t,r,a);if(!t.fail){var i=n.session_id.bytes(),s=null;t.sessionCache&&(s=t.sessionCache.getSession(i),null===s&&(i="")),0===i.length&&(i=e.random.getBytes(32)),t.session.id=i,t.session.clientHelloVersion=n.version,t.session.sp=s?s.sp:{},null!==s?(t.expect=S,t.session.resuming=!0,t.session.sp.client_random=n.random.bytes()):(t.expect=t.verifyClient!==!1?v:C,t.session.resuming=!1,o.createSecurityParameters(t,n)),t.open=!0,o.queue(t,o.createRecord({type:o.ContentType.handshake,data:o.createServerHello(t)})),t.session.resuming?(o.queue(t,o.createRecord({type:o.ContentType.change_cipher_spec,data:o.createChangeCipherSpec()})),t.state.pending=o.createConnectionState(t),t.state.current.write=t.state.pending.write,o.queue(t,o.createRecord({type:o.ContentType.handshake,data:o.createFinished(t)}))):(o.queue(t,o.createRecord({type:o.ContentType.handshake,data:o.createCertificate(t)})),o.queue(t,o.createRecord({type:o.ContentType.handshake,data:o.createServerKeyExchange(t)})),t.verifyClient!==!1&&o.queue(t,o.createRecord({type:o.ContentType.handshake,data:o.createCertificateRequest(t)})),o.queue(t,o.createRecord({type:o.ContentType.handshake,data:o.createServerHelloDone(t)}))),o.flush(t),t.process()}},o.handleCertificate=function(t,r,a){if(3>a)t.error(t,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.illegal_parameter}});else{var n,s,c=r.fragment,u={certificate_list:i(c,3)},f=[];try{for(;u.certificate_list.length()>0;)n=i(u.certificate_list,3),s=e.asn1.fromDer(n),n=e.pki.certificateFromAsn1(s,!0),f.push(n)}catch(d){t.error(t,{message:"Could not parse certificate list.",cause:d,send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.bad_certificate}})}if(!t.fail){var p=t.entity===o.ConnectionEnd.client;!p&&t.verifyClient!==!0||0!==f.length?0===f.length?t.expect=p?l:C:(p?t.session.serverCertificate=f[0]:t.session.clientCertificate=f[0],o.verifyCertificateChain(t,f)&&(t.expect=p?l:C)):t.error(t,{message:p?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.illegal_parameter}}),t.process()}}},o.handleServerKeyExchange=function(e,t,r){r>0?e.error(e,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.unsupported_certificate}}):(e.expect=f,e.process())},o.handleClientKeyExchange=function(t,r,a){if(48>a)t.error(t,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.unsupported_certificate}});else{var n=r.fragment;msg={enc_pre_master_secret:i(n,2).getBytes()};var s=null;if(t.getPrivateKey)try{s=t.getPrivateKey(t,t.session.serverCertificate),s=e.pki.privateKeyFromPem(s)}catch(c){t.error(t,{message:"Could not get private key.",cause:c,send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.internal_error}})}if(null===s)t.error(t,{message:"No private key set.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.internal_error}});else try{var u=t.session.sp;u.pre_master_secret=s.decrypt(msg.enc_pre_master_secret);var l=t.session.clientHelloVersion;if(l.major!==u.pre_master_secret.charCodeAt(0)||l.minor!==u.pre_master_secret.charCodeAt(1))throw{message:"TLS version rollback attack detected."}}catch(c){u.pre_master_secret=e.random.getBytes(48)}}t.fail||(t.expect=S,null!==t.session.clientCertificate&&(t.expect=E),t.process())},o.handleCertificateRequest=function(e,t,r){if(3>r)e.error(e,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.illegal_parameter}});else{var a=t.fragment,n={certificate_types:i(a,1),certificate_authorities:i(a,2)};e.session.certificateRequest=n,e.expect=d,e.process()}},o.handleCertificateVerify=function(t,r,a){if(2>a)t.error(t,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.illegal_parameter}});else{var n=r.fragment;n.read-=4;var s=n.bytes();n.read+=4,msg={signature:i(n,2).getBytes()};var c=e.util.createBuffer();c.putBuffer(t.session.md5.digest()),c.putBuffer(t.session.sha1.digest()),c=c.getBytes();try{var u=t.session.clientCertificate;if(n=e.pki.rsa.decrypt(msg.signature,u.publicKey,!0,c.length),n!==c)throw{message:"CertificateVerify signature does not match."};
t.session.md5.update(s),t.session.sha1.update(s)}catch(l){t.error(t,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.handshake_failure}})}t.fail||(t.expect=S,t.process())}},o.handleServerHelloDone=function(e,t,r){if(r>0)e.error(e,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.record_overflow}});else if(null===e.serverCertificate){var a={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.insufficient_security}},n=e.verify(e,a.alert.description,depth,[]);n===!0?a=null:((n||0===n)&&(n.constructor==Object?(n.message&&(a.message=n.message),n.alert&&(a.alert.description=n.alert)):n.constructor==Number&&(a.alert.description=n)),e.error(e,a))}if(e.fail||null===e.session.certificateRequest||(t=o.createRecord({type:o.ContentType.handshake,data:o.createCertificate(e)}),o.queue(e,t)),!e.fail){t=o.createRecord({type:o.ContentType.handshake,data:o.createClientKeyExchange(e)}),o.queue(e,t),e.expect=y;var i=function(e,t){null!==e.session.certificateRequest&&null!==e.session.clientCertificate&&o.queue(e,o.createRecord({type:o.ContentType.handshake,data:o.createCertificateVerify(e,t)})),o.queue(e,o.createRecord({type:o.ContentType.change_cipher_spec,data:o.createChangeCipherSpec()})),e.state.pending=o.createConnectionState(e),e.state.current.write=e.state.pending.write,o.queue(e,o.createRecord({type:o.ContentType.handshake,data:o.createFinished(e)})),e.expect=p,o.flush(e),e.process()};null===e.session.certificateRequest||null===e.session.clientCertificate?i(e,null):o.getClientSignature(e,i)}},o.handleChangeCipherSpec=function(e,t){if(1!=t.fragment.getByte())e.error(e,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.illegal_parameter}});else{var r=e.entity===o.ConnectionEnd.client;(e.session.resuming&&r||!e.session.resuming&&!r)&&(e.state.pending=o.createConnectionState(e)),e.state.current.read=e.state.pending.read,(!e.session.resuming&&r||e.session.resuming&&!r)&&(e.state.pending=null),e.expect=r?h:T,e.process()}},o.handleFinished=function(r,a){var n=a.fragment;n.read-=4;var i=n.bytes();n.read+=4;var s=a.fragment.getBytes();n=e.util.createBuffer(),n.putBuffer(r.session.md5.digest()),n.putBuffer(r.session.sha1.digest());var c=r.entity===o.ConnectionEnd.client,u=c?"server finished":"client finished",l=r.session.sp,f=12,d=t;n=d(l.master_secret,u,n.getBytes(),f),n.getBytes()!==s?r.error(r,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.decrypt_error}}):(r.session.md5.update(i),r.session.sha1.update(i),(r.session.resuming&&c||!r.session.resuming&&!c)&&(o.queue(r,o.createRecord({type:o.ContentType.change_cipher_spec,data:o.createChangeCipherSpec()})),r.state.current.write=r.state.pending.write,r.state.pending=null,o.queue(r,o.createRecord({type:o.ContentType.handshake,data:o.createFinished(r)}))),r.expect=c?g:I,r.handshaking=!1,++r.handshakes,r.peerCertificate=c?r.session.serverCertificate:r.session.clientCertificate,r.sessionCache?(r.session={id:r.session.id,sp:r.session.sp},r.session.sp.keys=null):r.session=null,o.flush(r),r.isConnected=!0,r.connected(r),r.process())},o.handleAlert=function(e,t){var r,a=t.fragment,n={level:a.getByte(),description:a.getByte()};switch(n.description){case o.Alert.Description.close_notify:r="Connection closed.";break;case o.Alert.Description.unexpected_message:r="Unexpected message.";break;case o.Alert.Description.bad_record_mac:r="Bad record MAC.";break;case o.Alert.Description.decryption_failed:r="Decryption failed.";break;case o.Alert.Description.record_overflow:r="Record overflow.";break;case o.Alert.Description.decompression_failure:r="Decompression failed.";break;case o.Alert.Description.handshake_failure:r="Handshake failure.";break;case o.Alert.Description.bad_certificate:r="Bad certificate.";break;case o.Alert.Description.unsupported_certificate:r="Unsupported certificate.";break;case o.Alert.Description.certificate_revoked:r="Certificate revoked.";break;case o.Alert.Description.certificate_expired:r="Certificate expired.";break;case o.Alert.Description.certificate_unknown:r="Certificate unknown.";break;case o.Alert.Description.illegal_parameter:r="Illegal parameter.";break;case o.Alert.Description.unknown_ca:r="Unknown certificate authority.";break;case o.Alert.Description.access_denied:r="Access denied.";break;case o.Alert.Description.decode_error:r="Decode error.";break;case o.Alert.Description.decrypt_error:r="Decrypt error.";break;case o.Alert.Description.export_restriction:r="Export restriction.";break;case o.Alert.Description.protocol_version:r="Unsupported protocol version.";break;case o.Alert.Description.insufficient_security:r="Insufficient security.";break;case o.Alert.Description.internal_error:r="Internal error.";break;case o.Alert.Description.user_canceled:r="User canceled.";break;case o.Alert.Description.no_renegotiation:r="Renegotiation not supported.";break;default:r="Unknown error."}n.description===o.Alert.Description.close_notify?e.close():(e.error(e,{message:r,send:!1,origin:e.entity===o.ConnectionEnd.client?"server":"client",alert:n}),e.process())},o.handleHandshake=function(t,r){var a=r.fragment,n=a.getByte(),i=a.getInt24();if(i>a.length())t.fragmented=r,r.fragment=e.util.createBuffer(),a.read-=4,t.process();else{t.fragmented=null,a.read-=4;var s=a.bytes(i+4);a.read+=4,n in O[t.entity][t.expect]?(t.entity!==o.ConnectionEnd.server||t.open||t.fail||(t.handshaking=!0,t.session={serverNameList:[],cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:e.md.md5.create(),sha1:e.md.sha1.create()}),n!==o.HandshakeType.hello_request&&n!==o.HandshakeType.certificate_verify&&n!==o.HandshakeType.finished&&(t.session.md5.update(s),t.session.sha1.update(s)),O[t.entity][t.expect][n](t,r,i)):o.handleUnexpected(t,r)}},o.handleApplicationData=function(e,t){e.data.putBuffer(t.fragment),e.dataReady(e),e.process()};var c=0,u=1,l=2,f=3,d=4,p=5,h=6,g=7,y=8,m=0,v=1,C=2,E=3,S=4,T=5,I=6,B=o.handleUnexpected,A=o.handleChangeCipherSpec,b=o.handleAlert,N=o.handleHandshake,R=o.handleApplicationData,k=[];k[o.ConnectionEnd.client]=[[B,B,N,B],[B,b,N,B],[B,b,N,B],[B,b,N,B],[B,b,N,B],[A,b,B,B],[B,b,N,B],[B,b,N,R],[B,b,N,B]],k[o.ConnectionEnd.server]=[[B,B,N,B],[B,b,N,B],[B,b,N,B],[B,b,N,B],[A,b,B,B],[B,b,N,B],[B,b,N,R],[B,b,N,B]];var U=o.handleHelloRequest,D=o.handleServerHello,L=o.handleCertificate,_=o.handleServerKeyExchange,w=o.handleCertificateRequest,V=o.handleServerHelloDone,P=o.handleFinished,O=[];O[o.ConnectionEnd.client]=[[B,B,D,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B],[U,B,B,B,B,B,B,B,B,B,B,L,_,w,V,B,B,B,B,B,B],[U,B,B,B,B,B,B,B,B,B,B,B,_,w,V,B,B,B,B,B,B],[U,B,B,B,B,B,B,B,B,B,B,B,B,w,V,B,B,B,B,B,B],[U,B,B,B,B,B,B,B,B,B,B,B,B,B,V,B,B,B,B,B,B],[U,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B],[U,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,P],[U,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B],[U,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B]];var x=o.handleClientHello,K=o.handleClientKeyExchange,q=o.handleCertificateVerify;O[o.ConnectionEnd.server]=[[B,x,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B],[B,B,B,B,B,B,B,B,B,B,B,L,B,B,B,B,B,B,B,B,B],[B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,K,B,B,B,B],[B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,q,B,B,B,B,B],[B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B],[B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,P],[B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B],[B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B]],o.generateKeys=function(e,r){var a=t,n=r.client_random+r.server_random;e.session.resuming||(r.master_secret=a(r.pre_master_secret,"master secret",n,48).bytes(),r.pre_master_secret=null),n=r.server_random+r.client_random;var i=2*r.mac_key_length+2*r.enc_key_length+2*r.fixed_iv_length,s=a(r.master_secret,"key expansion",n,i);return{client_write_MAC_key:s.getBytes(r.mac_key_length),server_write_MAC_key:s.getBytes(r.mac_key_length),client_write_key:s.getBytes(r.enc_key_length),server_write_key:s.getBytes(r.enc_key_length),client_write_IV:s.getBytes(r.fixed_iv_length),server_write_IV:s.getBytes(r.fixed_iv_length)}},o.createConnectionState=function(e){var t=e.entity===o.ConnectionEnd.client,r=function(){var e={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(){return!0},compressionState:null,compressFunction:function(){return!0},updateSequenceNumber:function(){4294967295==e.sequenceNumber[1]?(e.sequenceNumber[1]=0,++e.sequenceNumber[0]):++e.sequenceNumber[1]}};return e},i={read:r(),write:r()};if(i.read.update=function(e,t){return i.read.cipherFunction(t,i.read)?i.read.compressFunction(e,t,i.read)||e.error(e,{message:"Could not decompress record.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.decompression_failure}}):e.error(e,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.bad_record_mac}}),!e.fail},i.write.update=function(e,t){return i.write.compressFunction(e,t,i.write)?i.write.cipherFunction(t,i.write)||e.error(e,{message:"Could not encrypt record.",send:!1,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.internal_error}}):e.error(e,{message:"Could not compress record.",send:!1,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.internal_error}}),!e.fail},e.session){var s=e.session.sp;switch(e.session.cipherSuite.initSecurityParameters(s),s.keys=o.generateKeys(e,s),i.read.macKey=t?s.keys.server_write_MAC_key:s.keys.client_write_MAC_key,i.write.macKey=t?s.keys.client_write_MAC_key:s.keys.server_write_MAC_key,e.session.cipherSuite.initConnectionState(i,e,s),s.compression_algorithm){case o.CompressionMethod.none:break;case o.CompressionMethod.deflate:i.read.compressFunction=n,i.write.compressFunction=a;break;default:throw{message:"Unsupported compression algorithm."}}}return i},o.createRandom=function(){var t=new Date,r=+t+6e4*t.getTimezoneOffset(),a=e.util.createBuffer();return a.putInt32(r),a.putBytes(e.random.getBytes(28)),a},o.createRecord=function(e){var t={type:e.type,version:{major:o.Version.major,minor:o.Version.minor},length:e.data.length(),fragment:e.data};return t},o.createAlert=function(t){var r=e.util.createBuffer();return r.putByte(t.level),r.putByte(t.description),o.createRecord({type:o.ContentType.alert,data:r})},o.createClientHello=function(t){for(var r=e.util.createBuffer(),a=0;t.cipherSuites.length>a;++a){var n=t.cipherSuites[a];r.putByte(n.id[0]),r.putByte(n.id[1])}var i=r.length(),c=e.util.createBuffer();c.putByte(o.CompressionMethod.none);var u=c.length(),l=e.util.createBuffer();if(t.virtualHost){var f=e.util.createBuffer();f.putByte(0),f.putByte(0);var d=e.util.createBuffer();d.putByte(0),s(d,2,e.util.createBuffer(t.virtualHost));var p=e.util.createBuffer();s(p,2,d),s(f,2,p),l.putBuffer(f)}var h=l.length();h>0&&(h+=2);var g=t.session.id,y=g.length+1+2+4+28+2+i+1+u+h,m=e.util.createBuffer();return m.putByte(o.HandshakeType.client_hello),m.putInt24(y),m.putByte(o.Version.major),m.putByte(o.Version.minor),m.putBytes(t.session.sp.client_random),s(m,1,e.util.createBuffer(g)),s(m,2,r),s(m,1,c),h>0&&s(m,2,l),m},o.createServerHello=function(t){var r=t.session.id,a=r.length+1+2+4+28+2+1,n=e.util.createBuffer();return n.putByte(o.HandshakeType.server_hello),n.putInt24(a),n.putByte(o.Version.major),n.putByte(o.Version.minor),n.putBytes(t.session.sp.server_random),s(n,1,e.util.createBuffer(r)),n.putByte(t.session.cipherSuite.id[0]),n.putByte(t.session.cipherSuite.id[1]),n.putByte(t.session.compressionMethod),n},o.createCertificate=function(t){var r=t.entity===o.ConnectionEnd.client,a=null;t.getCertificate&&(a=t.getCertificate(t,r?t.session.certificateRequest:t.session.serverNameList));var n=e.util.createBuffer();if(null!==a)try{(Array.isArray&&!Array.isArray(a)||a.constructor!==Array)&&(a=[a]);for(var i=null,c=0;a.length>c;++c){var u=e.pki.pemToDer(a[c]);null===i&&(i=e.asn1.fromDer(u.bytes()));var l=e.util.createBuffer();s(l,3,u),n.putBuffer(l)}a=e.pki.certificateFromAsn1(i),r?t.session.clientCertificate=a:t.session.serverCertificate=a}catch(f){t.error(t,{message:"Could not send certificate list.",cause:f,send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.bad_certificate}})}var d=3+n.length(),p=e.util.createBuffer();return p.putByte(o.HandshakeType.certificate),p.putInt24(d),s(p,3,n),p},o.createClientKeyExchange=function(t){var r=e.util.createBuffer();r.putByte(o.Version.major),r.putByte(o.Version.minor),r.putBytes(e.random.getBytes(46));var a=t.session.sp;a.pre_master_secret=r.getBytes();var n=t.session.serverCertificate.publicKey;r=n.encrypt(a.pre_master_secret);var i=r.length+2,s=e.util.createBuffer();return s.putByte(o.HandshakeType.client_key_exchange),s.putInt24(i),s.putInt16(r.length),s.putBytes(r),s},o.createServerKeyExchange=function(){var t=0,r=e.util.createBuffer();return t>0&&(r.putByte(o.HandshakeType.server_key_exchange),r.putInt24(t)),r},o.getClientSignature=function(t,r){var a=e.util.createBuffer();a.putBuffer(t.session.md5.digest()),a.putBuffer(t.session.sha1.digest()),a=a.getBytes(),t.getSignature=t.getSignature||function(t,r,a){var n=null;if(t.getPrivateKey)try{n=t.getPrivateKey(t,t.session.clientCertificate),n=e.pki.privateKeyFromPem(n)}catch(i){t.error(t,{message:"Could not get private key.",cause:i,send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.internal_error}})}null===n?t.error(t,{message:"No private key set.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.internal_error}}):r=e.pki.rsa.encrypt(r,n,1),a(t,r)},t.getSignature(t,a,r)},o.createCertificateVerify=function(t,r){var a=r.length+2,n=e.util.createBuffer();return n.putByte(o.HandshakeType.certificate_verify),n.putInt24(a),n.putInt16(r.length),n.putBytes(r),n},o.createCertificateRequest=function(t){var r=e.util.createBuffer();r.putByte(1);var a=e.util.createBuffer();for(var n in t.caStore.certs){var i=t.caStore.certs[n],c=e.pki.distinguishedNameToAsn1(i.subject);a.putBuffer(e.asn1.toDer(c))}var u=1+r.length()+2+a.length(),l=e.util.createBuffer();return l.putByte(o.HandshakeType.certificate_request),l.putInt24(u),s(l,1,r),s(l,2,a),l},o.createServerHelloDone=function(){var t=e.util.createBuffer();return t.putByte(o.HandshakeType.server_hello_done),t.putInt24(0),t},o.createChangeCipherSpec=function(){var t=e.util.createBuffer();return t.putByte(1),t},o.createFinished=function(r){var a=e.util.createBuffer();a.putBuffer(r.session.md5.digest()),a.putBuffer(r.session.sha1.digest());var n=r.entity===o.ConnectionEnd.client,i=r.session.sp,s=12,c=t,u=n?"client finished":"server finished";a=c(i.master_secret,u,a.getBytes(),s);var l=e.util.createBuffer();return l.putByte(o.HandshakeType.finished),l.putInt24(a.length()),l.putBuffer(a),l},o.queue=function(t,r){if(r.type===o.ContentType.handshake){var a=r.fragment.bytes();t.session.md5.update(a),t.session.sha1.update(a),a=null}var n;if(r.fragment.length()<=o.MaxFragment)n=[r];else{n=[];for(var i=r.fragment.bytes();i.length>o.MaxFragment;)n.push(o.createRecord({type:r.type,data:e.util.createBuffer(i.slice(0,o.MaxFragment))})),i=i.slice(o.MaxFragment);i.length>0&&n.push(o.createRecord({type:r.type,data:e.util.createBuffer(i)}))}for(var s=0;n.length>s&&!t.fail;++s){var c=n[s],u=t.state.current.write;u.update(t,c)&&t.records.push(c)}},o.flush=function(e){for(var t=0;e.records.length>t;++t){var r=e.records[t];e.tlsData.putByte(r.type),e.tlsData.putByte(r.version.major),e.tlsData.putByte(r.version.minor),e.tlsData.putInt16(r.fragment.length()),e.tlsData.putBuffer(e.records[t].fragment)}return e.records=[],e.tlsDataReady(e)};var F=function(t){switch(t){case!0:return!0;case e.pki.certificateError.bad_certificate:return o.Alert.Description.bad_certificate;case e.pki.certificateError.unsupported_certificate:return o.Alert.Description.unsupported_certificate;case e.pki.certificateError.certificate_revoked:return o.Alert.Description.certificate_revoked;case e.pki.certificateError.certificate_expired:return o.Alert.Description.certificate_expired;case e.pki.certificateError.certificate_unknown:return o.Alert.Description.certificate_unknown;case e.pki.certificateError.unknown_ca:return o.Alert.Description.unknown_ca;default:return o.Alert.Description.bad_certificate}},M=function(t){switch(t){case!0:return!0;case o.Alert.Description.bad_certificate:return e.pki.certificateError.bad_certificate;case o.Alert.Description.unsupported_certificate:return e.pki.certificateError.unsupported_certificate;case o.Alert.Description.certificate_revoked:return e.pki.certificateError.certificate_revoked;case o.Alert.Description.certificate_expired:return e.pki.certificateError.certificate_expired;case o.Alert.Description.certificate_unknown:return e.pki.certificateError.certificate_unknown;case o.Alert.Description.unknown_ca:return e.pki.certificateError.unknown_ca;default:return e.pki.certificateError.bad_certificate}};o.verifyCertificateChain=function(t,r){try{e.pki.verifyCertificateChain(t.caStore,r,function(e,r,a){F(e);var n=t.verify(t,e,r,a);if(n!==!0){if(n.constructor===Object){var i={message:"The application rejected the certificate.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.bad_certificate}};throw n.message&&(i.message=n.message),n.alert&&(i.alert.description=n.alert),i}n!==e&&(n=M(n))}return n})}catch(a){a.constructor!==Object&&(a={send:!0,alert:{level:o.Alert.Level.fatal,description:F(a)}}),"send"in a||(a.send=!0),"alert"in a||(a.alert={level:o.Alert.Level.fatal,description:F(a.error)}),t.error(t,a)}return!t.fail},o.createSessionCache=function(t,r){var a=null;if(t&&t.getSession&&t.setSession&&t.order)a=t;else{a={},a.cache=t||{},a.capacity=Math.max(r||100,1),a.order=[];for(var n in t)r>=a.order.length?a.order.push(n):delete t[n];a.getSession=function(t){var r=null,n=null;if(t?n=e.util.bytesToHex(t):a.order.length>0&&(n=a.order[0]),null!==n&&n in a.cache){r=a.cache[n],delete a.cache[n];for(var i in a.order)if(a.order[i]===n){a.order.splice(i,1);break}}return r},a.setSession=function(t,r){if(a.order.length===a.capacity){var n=a.order.shift();delete a.cache[n]}var n=e.util.bytesToHex(t);a.order.push(n),a.cache[n]=r}}return a},o.createConnection=function(t){var r=null;r=t.caStore?Array.isArray&&Array.isArray(t.caStore)||t.caStore.constructor==Array?e.pki.createCaStore(t.caStore):t.caStore:e.pki.createCaStore();var a=t.cipherSuites||null;if(null===a){a=[];for(var n in o.CipherSuites)a.push(o.CipherSuites[n])}var i=t.server?o.ConnectionEnd.server:o.ConnectionEnd.client,s=t.sessionCache?o.createSessionCache(t.sessionCache):null,u={entity:i,sessionId:t.sessionId,caStore:r,sessionCache:s,cipherSuites:a,connected:t.connected,virtualHost:t.virtualHost||null,verifyClient:t.verifyClient||!1,verify:t.verify||function(e,t){return t},getCertificate:t.getCertificate||null,getPrivateKey:t.getPrivateKey||null,getSignature:t.getSignature||null,input:e.util.createBuffer(),tlsData:e.util.createBuffer(),data:e.util.createBuffer(),tlsDataReady:t.tlsDataReady,dataReady:t.dataReady,closed:t.closed,error:function(e,r){r.origin=r.origin||(e.entity===o.ConnectionEnd.client?"client":"server"),r.send&&(o.queue(e,o.createAlert(r.alert)),o.flush(e));var a=r.fatal!==!1;a&&(e.fail=!0),t.error(e,r),a&&e.close(!1)},deflate:t.deflate||null,inflate:t.inflate||null};u.reset=function(e){u.record=null,u.session=null,u.peerCertificate=null,u.state={pending:null,current:null},u.expect=u.entity===o.ConnectionEnd.client?c:m,u.fragmented=null,u.records=[],u.open=!1,u.handshakes=0,u.handshaking=!1,u.isConnected=!1,u.fail=!(e||e===void 0),u.input.clear(),u.tlsData.clear(),u.data.clear(),u.state.current=o.createConnectionState(u)},u.reset();var l=function(e,t){var r=t.type-o.ContentType.change_cipher_spec,a=k[e.entity][e.expect];r in a?a[r](e,t):o.handleUnexpected(e,t)},f=function(t){var r=0,a=t.input,n=a.length();return 5>n?r=5-n:(t.record={type:a.getByte(),version:{major:a.getByte(),minor:a.getByte()},length:a.getInt16(),fragment:e.util.createBuffer(),ready:!1},(t.record.version.major!=o.Version.major||t.record.version.minor!=o.Version.minor)&&t.error(t,{message:"Incompatible TLS version.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.protocol_version}})),r},d=function(e){var t=0,r=e.input,a=r.length();if(e.record.length>a)t=e.record.length-a;else{e.record.fragment.putBytes(r.getBytes(e.record.length));var n=e.state.current.read;n.update(e,e.record)&&(null!==e.fragmented&&(e.fragmented.type===e.record.type?(e.fragmented.fragment.putBuffer(e.record.fragment),e.record=e.fragmented):e.error(e,{message:"Invalid fragmented record.",send:!0,alert:{level:o.Alert.Level.fatal,description:o.Alert.Description.unexpected_message}})),e.record.ready=!0)}return t};return u.handshake=function(t){if(u.entity!==o.ConnectionEnd.client)u.error(u,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(u.handshaking)u.error(u,{message:"Handshake already in progress.",fatal:!1});else{u.fail&&!u.open&&0===u.handshakes&&(u.fail=!1),u.handshaking=!0,t=t||"";var r=null;t.length>0&&(u.sessionCache&&(r=u.sessionCache.getSession(t)),null===r&&(t="")),0===t.length&&u.sessionCache&&(r=u.sessionCache.getSession(),null!==r&&(t=r.id)),u.session={id:t,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:r?r.sp:{},md5:e.md.md5.create(),sha1:e.md.sha1.create()},u.session.sp.client_random=o.createRandom().getBytes(),u.open=!0,o.queue(u,o.createRecord({type:o.ContentType.handshake,data:o.createClientHello(u)})),o.flush(u)}},u.process=function(e){var t=0;return e&&u.input.putBytes(e),u.fail||(null!==u.record&&u.record.ready&&u.record.fragment.isEmpty()&&(u.record=null),null===u.record&&(t=f(u)),u.fail||null===u.record||u.record.ready||(t=d(u)),!u.fail&&null!==u.record&&u.record.ready&&l(u,u.record)),t},u.prepare=function(t){return o.queue(u,o.createRecord({type:o.ContentType.application_data,data:e.util.createBuffer(t)})),o.flush(u)},u.close=function(e){!u.fail&&u.sessionCache&&u.session&&u.sessionCache.setSession(u.session.id,u.session),u.open&&(u.open=!1,u.input.clear(),(u.isConnected||u.handshaking)&&(u.isConnected=u.handshaking=!1,o.queue(u,o.createAlert({level:o.Alert.Level.warning,description:o.Alert.Description.close_notify})),o.flush(u)),u.closed(u)),u.reset(e)},u},e.tls=e.tls||{};for(var G in o)"function"!=typeof o[G]&&(e.tls[G]=o[G]);e.tls.prf_tls1=t,e.tls.hmac_sha1=r,e.tls.createSessionCache=o.createSessionCache,e.tls.createConnection=o.createConnection}var t="tls",r=["./asn1","./hmac","./md","./pki","./random","./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){e.mgf=e.mgf||{};var t=e.mgf.mgf1=e.mgf1=e.mgf1||{};t.create=function(t){var r={generate:function(r,a){for(var n=new e.util.ByteBuffer,i=Math.ceil(a/t.digestLength),s=0;i>s;s++){var o=new e.util.ByteBuffer;o.putInt32(s),t.start(),t.update(r+o.getBytes()),n.putBuffer(t.digest())}return n.truncate(n.length()-a),n.getBytes()}};return r}}var t="mgf1",r=["./util"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}(),function(){function e(e){function t(t,a,n){var o=a.entity===e.tls.ConnectionEnd.client;t.read.cipherState={init:!1,cipher:e.aes.createDecryptionCipher(o?n.keys.server_write_key:n.keys.client_write_key),iv:o?n.keys.server_write_IV:n.keys.client_write_IV},t.write.cipherState={init:!1,cipher:e.aes.createEncryptionCipher(o?n.keys.client_write_key:n.keys.server_write_key),iv:o?n.keys.client_write_IV:n.keys.server_write_IV},t.read.cipherFunction=i,t.write.cipherFunction=r,t.read.macLength=t.write.macLength=n.mac_length,t.read.macFunction=t.write.macFunction=s.hmac_sha1}function r(t,r){var n=!1,i=r.macFunction(r.macKey,r.sequenceNumber,t);t.fragment.putBytes(i),r.updateSequenceNumber();var s;s=t.version.minor>1?e.random.getBytes(16):r.cipherState.init?null:r.cipherState.iv,r.cipherState.init=!0;var o=r.cipherState.cipher;return o.start(s),t.version.minor>1&&o.output.putBytes(s),o.update(t.fragment),o.finish(a)&&(t.fragment=o.output,t.length=t.fragment.length(),n=!0),n}function a(e,t,r){if(!r){var a=t.length()==e?e-1:e-t.length()-1;t.fillWithByte(a,a+1)}return!0}function n(e,t,r){var a=!0;if(r){for(var n=t.length(),i=t.last(),s=n-1-i;n-1>s;++s)a=a&&t.at(s)==i;a&&t.truncate(i+1)}return a}function i(t,r){var a=!1,i=r.cipherState.init?null:r.cipherState.iv;r.cipherState.init=!0;var s=r.cipherState.cipher;s.start(i),s.update(t.fragment),a=s.finish(n);for(var o=r.macLength,c="",u=0;o>u;++u)c+=String.fromCharCode(0);var l=s.output.length();l>=o?(t.fragment=s.output.getBytes(l-o),c=s.output.getBytes(o)):t.fragment=s.output.getBytes(),t.fragment=e.util.createBuffer(t.fragment),t.length=t.fragment.length();var f=r.macFunction(r.macKey,r.sequenceNumber,t);return r.updateSequenceNumber(),a=f===c&&a}var s=e.tls;s.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=s.BulkCipherAlgorithm.aes,e.cipher_type=s.CipherType.block,e.enc_key_length=16,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=s.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:t},s.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=s.BulkCipherAlgorithm.aes,e.cipher_type=s.CipherType.block,e.enc_key_length=32,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=s.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:t}}var t="aesCipherSuites",r=["./aes","./tls"],a=null;"function"!=typeof define&&("object"==typeof module&&module.exports?a=function(e,t){t(require,module)}:("undefined"==typeof forge&&(forge={}),e(forge))),(a||"function"==typeof define)&&(a||define)(["require","module"].concat(r),function(a,n){n.exports=function(n){var i=r.map(function(e){return a(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[t])return n[t];n.defined[t]=!0;for(var s=0;i.length>s;++s)i[s](n);return n[t]}})}();